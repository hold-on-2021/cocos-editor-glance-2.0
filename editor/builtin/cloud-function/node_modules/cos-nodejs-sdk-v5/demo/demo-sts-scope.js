var e=require("qcloud-cos-sts"),t=require("../index"),o=require("./config"),r=["name/cos:PutObject","name/cos:InitiateMultipartUpload","name/cos:ListMultipartUploads","name/cos:ListParts","name/cos:UploadPart","name/cos:CompleteMultipartUpload"];new t({getAuthorization:function(t,i){if(!function(e){return(e||[]).every(function(e){return r.includes(e.action)&&e.bucket===o.bucket&&e.region===o.region&&(e.prefix||"").startsWith("")})}())return console.log("deny Scope"),void 0;var n=e.getPolicy(t.Scope);e.getCredential({secretId:o.SecretId,secretKey:o.SecretKey,policy:n,proxy:"",region:"ap-guangzhou"},function(e,t){if(e)console.error(e);else{console.log(t);var o=t.credentials;i({TmpSecretId:o.tmpSecretId,TmpSecretKey:o.tmpSecretKey,XCosSecurityToken:o.sessionToken,ExpiredTime:t.expiredTime,ScopeLimit:!0})}})}}).putObject({Bucket:o.Bucket,Region:o.Region,Key:"dir/1.txt",Body:"hello!"},function(e,t){console.log(e||t)});