var n=require("constants"),c=process.cwd,t=null,o=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return t||(t=c.call(process)),t};try{process.cwd()}catch(n){}var r=process.chdir;process.chdir=function(n){t=null,r.call(process,n)},module.exports=function(c){n.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(c){c.lchmod=function(t,o,r){c.open(t,n.O_WRONLY|n.O_SYMLINK,o,function(n,t){if(n)return r&&r(n),void 0;c.fchmod(t,o,function(n){c.close(t,function(c){r&&r(n||c)})})})},c.lchmodSync=function(t,o){var r,e=c.openSync(t,n.O_WRONLY|n.O_SYMLINK,o),u=!0;try{r=c.fchmodSync(e,o),u=!1}finally{if(u)try{c.closeSync(e)}catch(n){}else c.closeSync(e)}return r}}(c);c.lutimes||function(c){n.hasOwnProperty("O_SYMLINK")?(c.lutimes=function(t,o,r,e){c.open(t,n.O_SYMLINK,function(n,t){if(n)return e&&e(n),void 0;c.futimes(t,o,r,function(n){c.close(t,function(c){e&&e(n||c)})})})},c.lutimesSync=function(t,o,r){var e,u=c.openSync(t,n.O_SYMLINK),i=!0;try{e=c.futimesSync(u,o,r),i=!1}finally{if(i)try{c.closeSync(u)}catch(n){}else c.closeSync(u)}return e}):(c.lutimes=function(n,c,t,o){o&&process.nextTick(o)},c.lutimesSync=function(){})}(c);c.chown=e(c.chown),c.fchown=e(c.fchown),c.lchown=e(c.lchown),c.chmod=t(c.chmod),c.fchmod=t(c.fchmod),c.lchmod=t(c.lchmod),c.chownSync=u(c.chownSync),c.fchownSync=u(c.fchownSync),c.lchownSync=u(c.lchownSync),c.chmodSync=r(c.chmodSync),c.fchmodSync=r(c.fchmodSync),c.lchmodSync=r(c.lchmodSync),c.stat=i(c.stat),c.fstat=i(c.fstat),c.lstat=i(c.lstat),c.statSync=f(c.statSync),c.fstatSync=f(c.fstatSync),c.lstatSync=f(c.lstatSync),c.lchmod||(c.lchmod=function(n,c,t){t&&process.nextTick(t)},c.lchmodSync=function(){});c.lchown||(c.lchown=function(n,c,t,o){o&&process.nextTick(o)},c.lchownSync=function(){});"win32"===o&&(c.rename=function(n){return function(t,o,r){var e=Date.now(),u=0;n(t,o,function i(f){if(f&&("EACCES"===f.code||"EPERM"===f.code)&&Date.now()-e<6e4)return setTimeout(function(){c.stat(o,function(c,e){c&&"ENOENT"===c.code?n(t,o,i):r(f)})},u),u<100&&(u+=10),void 0;r&&r(f)})}}(c.rename));function t(n){return n?function(t,o,r){return n.call(c,t,o,function(n){l(n)&&(n=null),r&&r.apply(this,arguments)})}:n}function r(n){return n?function(t,o){try{return n.call(c,t,o)}catch(n){if(!l(n))throw n}}:n}function e(n){return n?function(t,o,r,e){return n.call(c,t,o,r,function(n){l(n)&&(n=null),e&&e.apply(this,arguments)})}:n}function u(n){return n?function(t,o,r){try{return n.call(c,t,o,r)}catch(n){if(!l(n))throw n}}:n}function i(n){return n?function(t,o,r){function e(n,c){c&&(c.uid<0&&(c.uid+=4294967296),c.gid<0&&(c.gid+=4294967296)),r&&r.apply(this,arguments)}return"function"==typeof o&&(r=o,o=null),o?n.call(c,t,o,e):n.call(c,t,e)}:n}function f(n){return n?function(t,o){var r=o?n.call(c,t,o):n.call(c,t);return r.uid<0&&(r.uid+=4294967296),r.gid<0&&(r.gid+=4294967296),r}:n}function l(n){if(!n)return!0;if("ENOSYS"===n.code)return!0;var c=!process.getuid||0!==process.getuid();return!(!c||"EINVAL"!==n.code&&"EPERM"!==n.code)}c.read=function(n){function t(t,o,r,e,u,i){var f;if(i&&"function"==typeof i){var l=0;f=function(s,a,h){if(s&&"EAGAIN"===s.code&&l<10)return l++,n.call(c,t,o,r,e,u,f);i.apply(this,arguments)}}return n.call(c,t,o,r,e,u,f)}return t.__proto__=n,t}(c.read),c.readSync=function(n){return function(t,o,r,e,u){for(var i=0;;)try{return n.call(c,t,o,r,e,u)}catch(n){if("EAGAIN"===n.code&&i<10){i++;continue}throw n}}}(c.readSync)};