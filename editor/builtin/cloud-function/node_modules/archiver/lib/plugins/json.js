var i=require("util").inherits,e=require("readable-stream").Transform,r=require("buffer-crc32"),t=require("archiver-utils"),n=function(i){if(!(this instanceof n))return new n(i);i=this.options=t.defaults(i,{}),e.call(this,i),this.supports={directory:!0,symlink:!0},this.files=[]};i(n,e),n.prototype._transform=function(i,e,r){r(null,i)},n.prototype._writeStringified=function(){var i=JSON.stringify(this.files);this.write(i)},n.prototype.append=function(i,e,n){var s=this;function o(i,t){if(i)return n(i),void 0;e.size=t.length||0,e.crc32=r.unsigned(t),s.files.push(e),n(null,e)}e.crc32=0,"buffer"===e.sourceType?o(null,i):"stream"===e.sourceType&&t.collectStream(i,o)},n.prototype.finalize=function(){this._writeStringified(),this.end()},module.exports=n;