"use strict";var n=require("reusify");function e(){}function l(){this.value=null,this.callback=e,this.next=null,this.release=e,this.context=null;var n=this;this.worked=function(l,u){var t=n.callback;n.value=null,n.callback=e,t.call(n.context,l,u),n.release(n)}}module.exports=function(u,t,a){"function"==typeof u&&(a=t,t=u,u=null);var r=n(l),c=null,i=null,o=0,s={push:function(n,l){var a=r.get();a.context=u,a.release=d,a.value=n,a.callback=l||e,o===s.concurrency||s.paused?i?(i.next=a,i=a):(c=a,i=a,s.saturated()):(o++,t.call(u,a.value,a.worked))},drain:e,saturated:e,pause:function(){s.paused=!0},paused:!1,concurrency:a,running:function(){return o},resume:function(){if(s.paused){s.paused=!1;for(var n=0;n<s.concurrency;n++)o++,d()}},idle:function(){return 0===o&&0===s.length()},length:function(){for(var n=c,e=0;n;)n=n.next,e++;return e},unshift:function(n,l){var a=r.get();a.context=u,a.release=d,a.value=n,a.callback=l||e,o===s.concurrency||s.paused?c?(a.next=c,c=a):(c=a,i=a,s.saturated()):(o++,t.call(u,a.value,a.worked))},empty:e,kill:function(){c=null,i=null,s.drain=e},killAndDrain:function(){c=null,i=null,s.drain(),s.drain=e}};return s;function d(n){n&&r.release(n);var e=c;e?s.paused?o--:(i===c&&(i=null),c=e.next,e.next=null,t.call(u,e.value,e.worked),null===i&&s.empty()):0==--o&&s.drain()}};