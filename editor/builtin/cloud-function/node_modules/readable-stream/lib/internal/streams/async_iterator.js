"use strict";var e;function n(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var r=require("./end-of-stream"),t=Symbol("lastResolve"),l=Symbol("lastReject"),i=Symbol("error"),u=Symbol("ended"),o=Symbol("lastPromise"),a=Symbol("handlePromise"),s=Symbol("stream");function c(e,n){return{value:e,done:n}}function f(e){var n=e[t];if(null!==n){var r=e[s].read();null!==r&&(e[o]=null,e[t]=null,e[l]=null,n(c(r,!1)))}}var v=Object.getPrototypeOf(function(){}),d=Object.setPrototypeOf((n(e={get stream(){return this[s]},next:function(){var e=this,n=this[i];if(null!==n)return Promise.reject(n);if(this[u])return Promise.resolve(c(void 0,!0));if(this[s].destroyed)return new Promise(function(n,r){process.nextTick(function(){e[i]?r(e[i]):n(c(void 0,!0))})});var r,t=this[o];if(t)r=new Promise(function(e,n){return function(r,t){e.then(function(){if(n[u])return r(c(void 0,!0)),void 0;n[a](r,t)},t)}}(t,this));else{var l=this[s].read();if(null!==l)return Promise.resolve(c(l,!1));r=new Promise(this[a])}return this[o]=r,r}},Symbol.asyncIterator,function(){return this}),n(e,"return",function(){var e=this;return new Promise(function(n,r){e[s].destroy(null,function(e){if(e)return r(e),void 0;n(c(void 0,!0))})})}),e),v);module.exports=function(e){var v,b=Object.create(d,(n(v={},s,{value:e,writable:!0}),n(v,t,{value:null,writable:!0}),n(v,l,{value:null,writable:!0}),n(v,i,{value:null,writable:!0}),n(v,u,{value:e._readableState.endEmitted,writable:!0}),n(v,a,{value:function(e,n){var r=b[s].read();r?(b[o]=null,b[t]=null,b[l]=null,e(c(r,!1))):(b[t]=e,b[l]=n)},writable:!0}),v));return b[o]=null,r(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var n=b[l];return null!==n&&(b[o]=null,b[t]=null,b[l]=null,n(e)),b[i]=e,void 0}var r=b[t];null!==r&&(b[o]=null,b[t]=null,b[l]=null,r(c(void 0,!0))),b[u]=!0}),e.on("readable",function(e){process.nextTick(f,e)}.bind(null,b)),b};