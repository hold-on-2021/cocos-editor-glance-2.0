"use strict";var e=require("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}module.exports=function t(n,o,i){if("function"==typeof o)return t(n,null,o);o||(o={}),i=function(e){var r=!1;return function(){if(!r){r=!0;for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];e.apply(this,n)}}}(i||r);var a=o.readable||!1!==o.readable&&n.readable,l=o.writable||!1!==o.writable&&n.writable,s=function(){n.writable||u()},c=n._writableState&&n._writableState.finished,u=function(){l=!1,c=!0,a||i.call(n)},f=n._readableState&&n._readableState.endEmitted,d=function(){a=!1,f=!0,l||i.call(n)},b=function(e){i.call(n,e)},v=function(){var r;return a&&!f?(n._readableState&&n._readableState.ended||(r=new e),i.call(n,r)):l&&!c?(n._writableState&&n._writableState.ended||(r=new e),i.call(n,r)):void 0},m=function(){n.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(n)?(n.on("complete",u),n.on("abort",v),n.req?m():n.on("request",m)):l&&!n._writableState&&(n.on("end",s),n.on("close",s)),n.on("end",d),n.on("finish",u),!1!==o.error&&n.on("error",b),n.on("close",v),function(){n.removeListener("complete",u),n.removeListener("abort",v),n.removeListener("request",m),n.req&&n.req.removeListener("finish",u),n.removeListener("end",s),n.removeListener("close",s),n.removeListener("finish",u),n.removeListener("end",d),n.removeListener("error",b),n.removeListener("close",v)}};