const e=require("assert"),t=require("path"),r=require("fs");let o=void 0;try{o=require("glob")}catch(e){}const i={nosort:!0,silent:!0};let n=0;const c="win32"===process.platform,l=e=>{if(["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{e[t]=e[t]||r[t],e[t+="Sync"]=e[t]||r[t]}),e.maxBusyTries=e.maxBusyTries||3,e.emfileWait=e.emfileWait||1e3,!1===e.glob&&(e.disableGlob=!0),!0!==e.disableGlob&&void 0===o)throw Error("glob dependency not found, set `options.disableGlob = true` if intentional");e.disableGlob=e.disableGlob||!1,e.glob=e.glob||i},a=(t,r,i)=>{"function"==typeof r&&(i=r,r={}),e(t,"rimraf: missing path"),e.equal(typeof t,"string","rimraf: path should be a string"),e.equal(typeof i,"function","rimraf: callback function required"),e(r,"rimraf: invalid options argument provided"),e.equal(typeof r,"object","rimraf: options should be object"),l(r);let c=0,a=null,d=0;const f=(e,t)=>e?i(e):0===(d=t.length)?i():(t.forEach(e=>{const t=o=>{if(o){if(("EBUSY"===o.code||"ENOTEMPTY"===o.code||"EPERM"===o.code)&&c<r.maxBusyTries)return c++,setTimeout(()=>s(e,r,t),100*c);if("EMFILE"===o.code&&n<r.emfileWait)return setTimeout(()=>s(e,r,t),n++);"ENOENT"===o.code&&(o=null)}n=0,(e=>{a=a||e,0==--d&&i(a)})(o)};s(e,r,t)}),void 0);if(r.disableGlob||!o.hasMagic(t))return f(null,[t]);r.lstat(t,(e,i)=>{if(!e)return f(null,[t]);o(t,r.glob,f)})},s=(t,r,o)=>{e(t),e(r),e("function"==typeof o),r.lstat(t,(e,i)=>e&&"ENOENT"===e.code?o(null):(e&&"EPERM"===e.code&&c&&d(t,r,e,o),i&&i.isDirectory()?u(t,r,e,o):(r.unlink(t,e=>{if(e){if("ENOENT"===e.code)return o(null);if("EPERM"===e.code)return c?d(t,r,e,o):u(t,r,e,o);if("EISDIR"===e.code)return u(t,r,e,o)}return o(e)}),void 0)))},d=(t,r,o,i)=>{e(t),e(r),e("function"==typeof i),r.chmod(t,438,e=>{e?i("ENOENT"===e.code?null:o):r.stat(t,(e,n)=>{e?i("ENOENT"===e.code?null:o):n.isDirectory()?u(t,r,o,i):r.unlink(t,i)})})},f=(t,r,o)=>{e(t),e(r);try{r.chmodSync(t,438)}catch(e){if("ENOENT"===e.code)return;throw o}let i;try{i=r.statSync(t)}catch(e){if("ENOENT"===e.code)return;throw o}i.isDirectory()?h(t,r,o):r.unlinkSync(t)},u=(t,r,o,i)=>{e(t),e(r),e("function"==typeof i),r.rmdir(t,e=>{!e||"ENOTEMPTY"!==e.code&&"EEXIST"!==e.code&&"EPERM"!==e.code?e&&"ENOTDIR"===e.code?i(o):i(e):E(t,r,i)})},E=(r,o,i)=>{e(r),e(o),e("function"==typeof i),o.readdir(r,(e,n)=>{if(e)return i(e);let c,l=n.length;if(0===l)return o.rmdir(r,i);n.forEach(e=>{a(t.join(r,e),o,e=>{if(!c)return e?i(c=e):(0==--l&&o.rmdir(r,i),void 0)})})})},y=(t,r)=>{let i;if(l(r=r||{}),e(t,"rimraf: missing path"),e.equal(typeof t,"string","rimraf: path should be a string"),e(r,"rimraf: missing options"),e.equal(typeof r,"object","rimraf: options should be object"),r.disableGlob||!o.hasMagic(t))i=[t];else try{r.lstatSync(t),i=[t]}catch(e){i=o.sync(t,r.glob)}if(i.length)for(let e=0;e<i.length;e++){const t=i[e];let o;try{o=r.lstatSync(t)}catch(e){if("ENOENT"===e.code)return;"EPERM"===e.code&&c&&f(t,r,e)}try{o&&o.isDirectory()?h(t,r,null):r.unlinkSync(t)}catch(e){if("ENOENT"===e.code)return;if("EPERM"===e.code)return c?f(t,r,e):h(t,r,e);if("EISDIR"!==e.code)throw e;h(t,r,e)}}},h=(t,r,o)=>{e(t),e(r);try{r.rmdirSync(t)}catch(e){if("ENOENT"===e.code)return;if("ENOTDIR"===e.code)throw o;"ENOTEMPTY"!==e.code&&"EEXIST"!==e.code&&"EPERM"!==e.code||m(t,r)}},m=(r,o)=>{e(r),e(o),o.readdirSync(r).forEach(e=>y(t.join(r,e),o));const i=c?100:1;let n=0;for(;;){{let e=!0;try{const t=o.rmdirSync(r,o);return e=!1,t}finally{if(++n<i&&e)continue}}1}};module.exports=a,a.sync=y;