"use strict";const e=require("fill-range"),r=require("./stringify"),t=require("./utils"),n=(e="",r="",o=!1)=>{let i=[];if(e=[].concat(e),!(r=[].concat(r)).length)return e;if(!e.length)return o?t.flatten(r).map(e=>`{${e}}`):r;for(let t of e)if(Array.isArray(t))for(let e of t)i.push(n(e,r,o));else for(let e of r)!0===o&&"string"==typeof e&&(e=`{${e}}`),i.push(Array.isArray(e)?n(t,e,o):t+e);return t.flatten(i)};module.exports=((o,i={})=>{let p=void 0===i.rangeLimit?1e3:i.rangeLimit,a=(o,l={})=>{o.queue=[];let s=l,u=l.queue;for(;"brace"!==s.type&&"root"!==s.type&&s.parent;)u=(s=s.parent).queue;if(o.invalid||o.dollar)return u.push(n(u.pop(),r(o,i))),void 0;if("brace"===o.type&&!0!==o.invalid&&2===o.nodes.length)return u.push(n(u.pop(),["{}"])),void 0;if(o.nodes&&o.ranges>0){let a=t.reduce(o.nodes);if(t.exceedsLimit(...a,i.step,p))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let l=e(...a,i);return 0===l.length&&(l=r(o,i)),u.push(n(u.pop(),l)),o.nodes=[],void 0}let f=t.encloseBrace(o),d=o.queue,c=o;for(;"brace"!==c.type&&"root"!==c.type&&c.parent;)d=(c=c.parent).queue;for(let e=0;e<o.nodes.length;e++){let r=o.nodes[e];"comma"!==r.type||"brace"!==o.type?"close"!==r.type?r.value&&"open"!==r.type?d.push(n(d.pop(),r.value)):r.nodes&&a(r,o):u.push(n(u.pop(),d,f)):(1===e&&d.push(""),d.push(""))}return d};return t.flatten(a(o))});