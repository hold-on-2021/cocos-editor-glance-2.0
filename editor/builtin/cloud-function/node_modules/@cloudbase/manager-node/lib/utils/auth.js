"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("crypto"));function r(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}exports.getAuth=function(e){const o=e.secretId,a=e.secretKey,s=e.method.toLowerCase()||"get",n=e.params||{},i=e.headers||{};let c=e.pathname||"/";if(0!==c.indexOf("/")&&(c="/"+c),!o)throw Error("missing param SecretId");if(!a)throw Error("missing param SecretKey");const u=function(e){return Object.keys(e).filter(t=>void 0!==e[t]).sort()},l=function(e){const t=[];return u(e).forEach(o=>{let a=null===e[o]||void 0===e[o]?"":e[o];"string"!=typeof a&&(a=JSON.stringify(a)),t.push(`${r(o.toLowerCase())}=${r(a)}`)}),t.join("&")},d=Math.floor(Date.now()/1e3)-1,f=o,h=d+";"+(d+900),p=u(i).join(";").toLowerCase(),g=u(n).join(";").toLowerCase(),m=t.default.createHmac("sha1",a).update(h).digest("hex"),j=[s,c,l(n),l(i),""].join("\n"),q=t.default.createHash("sha1");q.update(Buffer.from(j));const y=["sha1",h,q.digest("hex"),""].join("\n");return["q-sign-algorithm=sha1","q-ak="+f,"q-sign-time="+h,"q-key-time="+h,"q-header-list="+p,"q-url-param-list="+g,"q-signature="+t.default.createHmac("sha1",m).update(y).digest("hex")].join("&")};