var e=require("crypto"),t=require("jsbn").BigInteger,r=(require("./lib/ec.js").ECPointFp,require("safer-buffer").Buffer);function i(e,t){return e.length>=t?e:i("0"+e,t)}exports.ECCurves=require("./lib/sec.js"),exports.ECKey=function(n,o,s){var u,h=n(),g=h.getN(),f=Math.floor(g.bitLength()/8);if(o)if(s){n=h.getCurve();this.P=n.decodePointHex(o.toString("hex"))}else{if(o.length!=f)return!1;u=new t(o.toString("hex"),16)}else{var l=g.subtract(t.ONE),a=new t(e.randomBytes(g.bitLength()));u=a.mod(l).add(t.ONE),this.P=h.getG().multiply(u)}this.P&&(this.PublicKey=r.from(h.getCurve().encodeCompressedPointHex(this.P),"hex")),u&&(this.PrivateKey=r.from(i(u.toString(16),2*f),"hex"),this.deriveSharedSecret=function(e){if(!e||!e.P)return!1;var t=e.P.multiply(u);return r.from(i(t.getX().toBigInteger().toString(16),2*f),"hex")})};