"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../utils");exports.default=class{constructor(t,e){this._settings=t,this._micromatchOptions=e,this.index=new Map}getFilter(e,i){const s=t.pattern.convertPatternsToRe(e,this._micromatchOptions),r=t.pattern.convertPatternsToRe(i,this._micromatchOptions);return t=>this._filter(t,s,r)}_filter(t,e,i){if(this._settings.unique){if(this._isDuplicateEntry(t))return!1;this._createIndexRecord(t)}if(this._onlyFileFilter(t)||this._onlyDirectoryFilter(t))return!1;if(this._isSkippedByAbsoluteNegativePatterns(t,i))return!1;const s=this._settings.baseNameMatch?t.name:t.path;return this._isMatchToPatterns(s,e)&&!this._isMatchToPatterns(t.path,i)}_isDuplicateEntry(t){return this.index.has(t.path)}_createIndexRecord(t){this.index.set(t.path,void 0)}_onlyFileFilter(t){return this._settings.onlyFiles&&!t.dirent.isFile()}_onlyDirectoryFilter(t){return this._settings.onlyDirectories&&!t.dirent.isDirectory()}_isSkippedByAbsoluteNegativePatterns(e,i){if(!this._settings.absolute)return!1;const s=t.path.makeAbsolute(this._settings.cwd,e.path);return this._isMatchToPatterns(s,i)}_isMatchToPatterns(e,i){const s=t.path.removeLeadingDotSegment(e);return t.pattern.matchAny(s,i)}};