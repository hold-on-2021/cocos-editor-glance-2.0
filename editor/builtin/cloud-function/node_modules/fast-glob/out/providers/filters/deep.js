"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../../utils"),e=require("../matchers/partial");exports.default=class{constructor(t,e){this._settings=t,this._micromatchOptions=e}getFilter(t,e,i){const s=this._getMatcher(e),r=this._getNegativePatternsRe(i);return e=>this._filter(t,e,s,r)}_getMatcher(t){return new e.default(t,this._settings,this._micromatchOptions)}_getNegativePatternsRe(e){const i=e.filter(t.pattern.isAffectDepthOfReadingPattern);return t.pattern.convertPatternsToRe(i,this._micromatchOptions)}_filter(e,i,s,r){const n=this._getEntryLevel(e,i.path);if(this._isSkippedByDeep(n))return!1;if(this._isSkippedSymbolicLink(i))return!1;const a=t.path.removeLeadingDotSegment(i.path);return!this._isSkippedByPositivePatterns(a,s)&&this._isSkippedByNegativePatterns(a,r)}_isSkippedByDeep(t){return t>=this._settings.deep}_isSkippedSymbolicLink(t){return!this._settings.followSymbolicLinks&&t.dirent.isSymbolicLink()}_getEntryLevel(t,e){const i=t.split("/").length;return e.split("/").length-(""===t?0:i)}_isSkippedByPositivePatterns(t,e){return!this._settings.baseNameMatch&&!e.match(t)}_isSkippedByNegativePatterns(e,i){return!t.pattern.matchAny(e,i)}};