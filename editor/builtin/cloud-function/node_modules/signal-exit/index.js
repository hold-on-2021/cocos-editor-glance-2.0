var e,t=require("assert"),r=require("./signals.js"),i=require("events");function s(){c&&(c=!1,r.forEach(function(e){try{process.removeListener(e,o[e])}catch(e){}}),process.emit=p,process.reallyExit=u,e.count-=1)}function n(t,r,i){e.emitted[t]||(e.emitted[t]=!0,e.emit(t,r,i))}"function"!=typeof i&&(i=i.EventEmitter),process.__signal_exit_emitter__?e=process.__signal_exit_emitter__:((e=process.__signal_exit_emitter__=new i).count=0,e.emitted={}),e.infinite||(e.setMaxListeners(1/0),e.infinite=!0),module.exports=function(r,i){t.equal(typeof r,"function","a callback must be provided for exit handler"),!1===c&&l();var n="exit";i&&i.alwaysLast&&(n="afterexit");return e.on(n,r),function(){e.removeListener(n,r),0===e.listeners("exit").length&&0===e.listeners("afterexit").length&&s()}},module.exports.unload=s;var o={};r.forEach(function(t){o[t]=function(){process.listeners(t).length===e.count&&(s(),n("exit",null,t),n("afterexit",null,t),process.kill(process.pid,t))}}),module.exports.signals=function(){return r},module.exports.load=l;var c=!1;function l(){c||(c=!0,e.count+=1,r=r.filter(function(e){try{return process.on(e,o[e]),!0}catch(e){return!1}}),process.emit=x,process.reallyExit=a)}var u=process.reallyExit;function a(e){process.exitCode=e||0,n("exit",process.exitCode,null),n("afterexit",process.exitCode,null),u.call(process,process.exitCode)}var p=process.emit;function x(e,t){if("exit"===e){void 0!==t&&(process.exitCode=t);var r=p.apply(this,arguments);return n("exit",process.exitCode,null),n("afterexit",process.exitCode,null),r}return p.apply(this,arguments)}