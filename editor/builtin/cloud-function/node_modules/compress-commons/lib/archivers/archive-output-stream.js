var r=require("util").inherits,i=require("readable-stream").Transform,t=require("./archive-entry"),e=require("../util"),n=module.exports=function(r){if(!(this instanceof n))return new n(r);i.call(this,r),this.offset=0,this._archive={finish:!1,finished:!1,processing:!1}};r(n,i),n.prototype._appendBuffer=function(r,i,t){},n.prototype._appendStream=function(r,i,t){},n.prototype._emitErrorCallback=function(r){r&&this.emit("error",r)},n.prototype._finish=function(r){},n.prototype._normalizeEntry=function(r){},n.prototype._transform=function(r,i,t){t(null,r)},n.prototype.entry=function(r,i,n){if(i=i||null,"function"!=typeof n&&(n=this._emitErrorCallback.bind(this)),!(r instanceof t))return n(new Error("not a valid instance of ArchiveEntry")),void 0;if(this._archive.finish||this._archive.finished)return n(new Error("unacceptable entry after finish")),void 0;if(this._archive.processing)return n(new Error("already processing an entry")),void 0;if(this._archive.processing=!0,this._normalizeEntry(r),this._entry=r,i=e.normalizeInputSource(i),Buffer.isBuffer(i))this._appendBuffer(r,i,n);else{if(!e.isStream(i))return this._archive.processing=!1,n(new Error("input source must be valid Stream or Buffer instance")),void 0;this._appendStream(r,i,n)}return this},n.prototype.finish=function(){if(this._archive.processing)return this._archive.finish=!0,void 0;this._finish()},n.prototype.getBytesWritten=function(){return this.offset},n.prototype.write=function(r,t){return r&&(this.offset+=r.length),i.prototype.write.call(this,r,t)};