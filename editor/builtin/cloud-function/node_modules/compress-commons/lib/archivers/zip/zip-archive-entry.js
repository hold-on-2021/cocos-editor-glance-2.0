var t=require("util").inherits,e=require("normalize-path"),r=require("../archive-entry"),i=require("./general-purpose-bit"),o=require("./unix-stat"),n=require("./constants"),s=require("./util"),p=module.exports=function(t){if(!(this instanceof p))return new p(t);r.call(this),this.platform=n.PLATFORM_FAT,this.method=-1,this.name=null,this.size=0,this.csize=0,this.gpb=new i,this.crc=0,this.time=-1,this.minver=n.MIN_VERSION_INITIAL,this.mode=-1,this.extra=null,this.exattr=0,this.inattr=0,this.comment=null,t&&this.setName(t)};t(p,r),p.prototype.getCentralDirectoryExtra=function(){return this.getExtra()},p.prototype.getComment=function(){return null!==this.comment?this.comment:""},p.prototype.getCompressedSize=function(){return this.csize},p.prototype.getCrc=function(){return this.crc},p.prototype.getExternalAttributes=function(){return this.exattr},p.prototype.getExtra=function(){return null!==this.extra?this.extra:n.EMPTY},p.prototype.getGeneralPurposeBit=function(){return this.gpb},p.prototype.getInternalAttributes=function(){return this.inattr},p.prototype.getLastModifiedDate=function(){return this.getTime()},p.prototype.getLocalFileDataExtra=function(){return this.getExtra()},p.prototype.getMethod=function(){return this.method},p.prototype.getName=function(){return this.name},p.prototype.getPlatform=function(){return this.platform},p.prototype.getSize=function(){return this.size},p.prototype.getTime=function(){return-1!==this.time?s.dosToDate(this.time):-1},p.prototype.getTimeDos=function(){return-1!==this.time?this.time:0},p.prototype.getUnixMode=function(){return this.platform!==n.PLATFORM_UNIX?0:this.getExternalAttributes()>>n.SHORT_SHIFT&n.SHORT_MASK},p.prototype.getVersionNeededToExtract=function(){return this.minver},p.prototype.setComment=function(t){Buffer.byteLength(t)!==t.length&&this.getGeneralPurposeBit().useUTF8ForNames(!0),this.comment=t},p.prototype.setCompressedSize=function(t){if(t<0)throw new Error("invalid entry compressed size");this.csize=t},p.prototype.setCrc=function(t){if(t<0)throw new Error("invalid entry crc32");this.crc=t},p.prototype.setExternalAttributes=function(t){this.exattr=t>>>0},p.prototype.setExtra=function(t){this.extra=t},p.prototype.setGeneralPurposeBit=function(t){if(!(t instanceof i))throw new Error("invalid entry GeneralPurposeBit");this.gpb=t},p.prototype.setInternalAttributes=function(t){this.inattr=t},p.prototype.setMethod=function(t){if(t<0)throw new Error("invalid entry compression method");this.method=t},p.prototype.setName=function(t){t=e(t,!1).replace(/^\w+:/,"").replace(/^(\.\.\/|\/)+/,""),Buffer.byteLength(t)!==t.length&&this.getGeneralPurposeBit().useUTF8ForNames(!0),this.name=t},p.prototype.setPlatform=function(t){this.platform=t},p.prototype.setSize=function(t){if(t<0)throw new Error("invalid entry size");this.size=t},p.prototype.setTime=function(t,e){if(!(t instanceof Date))throw new Error("invalid entry time");this.time=s.dateToDos(t,e)},p.prototype.setUnixMode=function(t){var e=0;e|=(t|=this.isDirectory()?n.S_IFDIR:n.S_IFREG)<<n.SHORT_SHIFT|(this.isDirectory()?n.S_DOS_D:n.S_DOS_A),this.setExternalAttributes(e),this.mode=t&n.MODE_MASK,this.platform=n.PLATFORM_UNIX},p.prototype.setVersionNeededToExtract=function(t){this.minver=t},p.prototype.isDirectory=function(){return"/"===this.getName().slice(-1)},p.prototype.isUnixSymlink=function(){return(this.getUnixMode()&o.FILE_TYPE_FLAG)===o.LINK_FLAG},p.prototype.isZip64=function(){return this.csize>n.ZIP64_MAGIC||this.size>n.ZIP64_MAGIC};