"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(o,l,f){if(null==l)l=1;else if(0===l)throw new Error("Concurrency must not be zero");var i=(0,s.default)(o),d=0,c=[],p=!1;function h(e,n,a){if(null!=a&&"function"!=typeof a)throw new Error("task callback must be a function");if(_.started=!0,(0,t.default)(e)||(e=[e]),0===e.length&&_.idle())return(0,u.default)(function(){_.drain()});for(var s=0,o=e.length;s<o;s++){var l={data:e[s],callback:a||r.default};n?_._tasks.unshift(l):_._tasks.push(l)}p||(p=!0,(0,u.default)(function(){p=!1,_.process()}))}function k(t){return function(r){d-=1;for(var n=0,u=t.length;n<u;n++){var a=t[n],s=(0,e.default)(c,a,0);0===s?c.shift():s>0&&c.splice(s,1),a.callback.apply(a,arguments),null!=r&&_.error(r,a.data)}d<=_.concurrency-_.buffer&&_.unsaturated(),_.idle()&&_.drain(),_.process()}}var y=!1,_={_tasks:new a.default,concurrency:l,payload:f,saturated:r.default,unsaturated:r.default,buffer:l/4,empty:r.default,drain:r.default,error:r.default,started:!1,paused:!1,push:function(e,t){h(e,!1,t)},kill:function(){_.drain=r.default,_._tasks.empty()},unshift:function(e,t){h(e,!0,t)},remove:function(e){_._tasks.remove(e)},process:function(){if(!y){for(y=!0;!_.paused&&d<_.concurrency&&_._tasks.length;){var e=[],t=[],r=_._tasks.length;_.payload&&(r=Math.min(r,_.payload));for(var u=0;u<r;u++){var a=_._tasks.shift();e.push(a),c.push(a),t.push(a.data)}d+=1,0===_._tasks.length&&_.empty(),d===_.concurrency&&_.saturated();var s=(0,n.default)(k(e));i(t,s)}y=!1}},length:function(){return _._tasks.length},running:function(){return d},workersList:function(){return c},idle:function(){return _._tasks.length+d===0},pause:function(){_.paused=!0},resume:function(){!1!==_.paused&&(_.paused=!1,(0,u.default)(_.process))}};return _};var e=o(require("lodash/_baseIndexOf")),t=o(require("lodash/isArray")),r=o(require("lodash/noop")),n=o(require("./onlyOnce")),u=o(require("./setImmediate")),a=o(require("./DoublyLinkedList")),s=o(require("./wrapAsync"));function o(e){return e&&e.__esModule?e:{default:e}}module.exports=exports.default;