var e=require("graceful-fs"),r=require("path"),n=(require("util"),require("lazystream")),t=require("normalize-path"),a=require("lodash.defaults"),i=require("stream").Stream,u=require("readable-stream").PassThrough,f=module.exports={};f.file=require("./file.js"),f.collectStream=function(e,r){var n=[],t=0;e.on("error",r),e.on("data",function(e){n.push(e),t+=e.length}),e.on("end",function(){var e=new Buffer(t),a=0;n.forEach(function(r){r.copy(e,a),a+=r.length}),r(null,e)})},f.dateify=function(e){return e=(e=e||new Date)instanceof Date?e:"string"==typeof e?new Date(e):new Date},f.defaults=function(e,r,n){var t=arguments;return t[0]=t[0]||{},a(...t)},f.isStream=function(e){return e instanceof i},f.lazyReadStream=function(r){return new n.Readable(function(){return e.createReadStream(r)})},f.normalizeInputSource=function(e){if(null===e)return new Buffer(0);if("string"==typeof e)return new Buffer(e);if(f.isStream(e)&&!e._readableState){var r=new u;return e.pipe(r),r}return e},f.sanitizePath=function(e){return t(e,!1).replace(/^\w+:/,"").replace(/^(\.\.\/|\/)+/,"")},f.trailingSlashIt=function(e){return"/"!==e.slice(-1)?e+"/":e},f.unixifyPath=function(e){return t(e,!1).replace(/^\w+:/,"")},f.walkdir=function(n,t,a){var i=[];"function"==typeof t&&(a=t,t=n),e.readdir(n,function(u,o){var c,l,s=0;if(u)return a(u);(function u(){if(!(c=o[s++]))return a(null,i);l=r.join(n,c),e.stat(l,function(e,n){i.push({path:l,relative:r.relative(t,l).replace(/\\/g,"/"),stats:n}),n&&n.isDirectory()?f.walkdir(l,t,function(e,r){r.forEach(function(e){i.push(e)}),u()}):u()})})()})};