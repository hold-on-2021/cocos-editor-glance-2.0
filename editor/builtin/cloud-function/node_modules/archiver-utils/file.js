var r=require("graceful-fs"),e=require("path"),n=require("lodash.flatten"),t=require("lodash.difference"),a=require("lodash.union"),i=require("lodash.isplainobject"),s=require("glob"),c=module.exports={},u=/[\/\\]/g;c.exists=function(){var n=e.join.apply(e,arguments);return r.existsSync(n)},c.expand=function(...c){var u=i(c[0])?c.shift():{},f=Array.isArray(c[0])?c[0]:c;if(0===f.length)return[];var o=function(r,e){var i=[];return n(r).forEach(function(r){var n=0===r.indexOf("!");n&&(r=r.slice(1));var s=e(r);i=n?t(i,s):a(i,s)}),i}(f,function(r){return s.sync(r,u)});return u.filter&&(o=o.filter(function(n){n=e.join(u.cwd||"",n);try{return"function"==typeof u.filter?u.filter(n):r.statSync(n)[u.filter]()}catch(r){return!1}})),o},c.expandMapping=function(r,n,t){t=Object.assign({rename:function(r,n){return e.join(r||"",n)}},t);var a=[],i={};return c.expand(t,r).forEach(function(r){var s=r;t.flatten&&(s=e.basename(s)),t.ext&&(s=s.replace(/(\.[^\/]*)?$/,t.ext));var c=t.rename(n,s,t);t.cwd&&(r=e.join(t.cwd,r)),c=c.replace(u,"/"),r=r.replace(u,"/"),i[c]?i[c].src.push(r):(a.push({src:[r],dest:c}),i[c]=a[a.length-1])}),a},c.normalizeFilesArray=function(r){var e=[];return r.forEach(function(r){("src"in r||"dest"in r)&&e.push(r)}),0===e.length?[]:e=_(e).chain().forEach(function(r){"src"in r&&r.src&&(Array.isArray(r.src)?r.src=n(r.src):r.src=[r.src])}).map(function(r){var e=Object.assign({},r);if(delete e.src,delete e.dest,r.expand)return c.expandMapping(r.src,r.dest,e).map(function(e){var n=Object.assign({},r);return n.orig=Object.assign({},r),n.src=e.src,n.dest=e.dest,["expand","cwd","flatten","rename","ext"].forEach(function(r){delete n[r]}),n});var t=Object.assign({},r);return t.orig=Object.assign({},r),"src"in t&&Object.defineProperty(t,"src",{enumerable:!0,get:function t(){var a;return"result"in t||(a=r.src,a=Array.isArray(a)?n(a):[a],t.result=c.expand(e,a)),t.result}}),"dest"in t&&(t.dest=r.dest),t}).flatten().value()};