"use strict";var e=require("crypto");exports.calculateMac=function(a,t){var r="hawk.1.header\n"+t.ts+"\n"+t.nonce+"\n"+(t.method||"").toUpperCase()+"\n"+t.resource+"\n"+t.host.toLowerCase()+"\n"+t.port+"\n"+(t.hash||"")+"\n";return t.ext&&(r+=t.ext.replace("\\","\\\\").replace("\n","\\n")),r+="\n",t.app&&(r=r+t.app+"\n"+(t.dlg||"")+"\n"),e.createHmac(a.algorithm,a.key).update(r).digest("base64")},exports.header=function(a,t,r){var n=r.timestamp||Math.floor((Date.now()+(r.localtimeOffsetMsec||0))/1e3),o=r.credentials;if(!(o&&o.id&&o.key&&o.algorithm))return"";if(-1===["sha1","sha256"].indexOf(o.algorithm))return"";var p={ts:n,nonce:r.nonce||function(a){var t=6*(a+1);return e.randomBytes(Math.ceil(t/8)).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"").slice(0,a)}(6),method:t,resource:a.pathname+(a.search||""),host:a.hostname,port:a.port||("http:"===a.protocol?80:443),hash:r.hash,ext:r.ext,app:r.app,dlg:r.dlg};p.hash||!r.payload&&""!==r.payload||(p.hash=function(a,t,r){var n=e.createHash(t);return n.update("hawk.1.payload\n"),n.update((r?r.split(";")[0].trim().toLowerCase():"")+"\n"),n.update(a||""),n.update("\n"),n.digest("base64")}(r.payload,o.algorithm,r.contentType));var s=exports.calculateMac(o,p),c=null!==p.ext&&void 0!==p.ext&&""!==p.ext,h='Hawk id="'+o.id+'", ts="'+p.ts+'", nonce="'+p.nonce+(p.hash?'", hash="'+p.hash:"")+(c?'", ext="'+p.ext.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'", mac="'+s+'"';return p.app&&(h=h+', app="'+p.app+(p.dlg?'", dlg="'+p.dlg:"")+'"'),h};