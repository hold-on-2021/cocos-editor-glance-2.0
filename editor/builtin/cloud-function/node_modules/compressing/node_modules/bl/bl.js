var t=require("readable-stream/duplex"),e=require("util"),n=require("safe-buffer").Buffer;function i(e){if(!(this instanceof i))return new i(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var n=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(t){t.on("error",n)}),this.on("unpipe",function(t){t.removeListener("error",n)})}else this.append(e);t.call(this)}e.inherits(i,t),i.prototype._offset=function(t){var e,n=0,i=0;if(0===t)return[0,0];for(;i<this._bufs.length;i++){if(t<(e=n+this._bufs[i].length)||i==this._bufs.length-1)return[i,t-n];n=e}},i.prototype.append=function(t){var e=0;if(n.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;e<t.length;e++)this.append(t[e]);else if(t instanceof i)for(;e<t._bufs.length;e++)this.append(t._bufs[e]);else null!=t&&("number"==typeof t&&(t=t.toString()),this._appendBuffer(n.from(t)));return this},i.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},i.prototype._write=function(t,e,n){this._appendBuffer(t),"function"==typeof n&&n()},i.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},i.prototype.end=function(e){t.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},i.prototype.get=function(t){return this.slice(t,t+1)[0]},i.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},i.prototype.copy=function(t,e,i,s){if(("number"!=typeof i||i<0)&&(i=0),("number"!=typeof s||s>this.length)&&(s=this.length),i>=this.length)return t||n.alloc(0);if(s<=0)return t||n.alloc(0);var r,h,f=!!t,o=this._offset(i),u=s-i,l=u,p=f&&e||0,a=o[1];if(0===i&&s==this.length){if(!f)return 1===this._bufs.length?this._bufs[0]:n.concat(this._bufs,this.length);for(h=0;h<this._bufs.length;h++)this._bufs[h].copy(t,p),p+=this._bufs[h].length;return t}if(l<=this._bufs[o[0]].length-a)return f?this._bufs[o[0]].copy(t,e,a,a+l):this._bufs[o[0]].slice(a,a+l);for(f||(t=n.allocUnsafe(u)),h=o[0];h<this._bufs.length;h++){if(!(l>(r=this._bufs[h].length-a))){this._bufs[h].copy(t,p,a,a+l);break}this._bufs[h].copy(t,p,a),p+=r,l-=r,a&&(a=0)}return t},i.prototype.shallowSlice=function(t,e){t=t||0,e=e||this.length,t<0&&(t+=this.length),e<0&&(e+=this.length);var n=this._offset(t),s=this._offset(e),r=this._bufs.slice(n[0],s[0]+1);return 0==s[1]?r.pop():r[r.length-1]=r[r.length-1].slice(0,s[1]),0!=n[1]&&(r[0]=r[0].slice(n[1])),new i(r)},i.prototype.toString=function(t,e,n){return this.slice(e,n).toString(t)},i.prototype.consume=function(t){for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){for(var t=0,e=new i;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},i.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in t)(function(e){i.prototype[e]=function(n){return this.slice(n,n+t[e])[e](0)}})(e)}(),module.exports=i;