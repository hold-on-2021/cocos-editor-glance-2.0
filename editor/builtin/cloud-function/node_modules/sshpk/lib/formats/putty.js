module.exports={read:function(n,o){var u,s=n.toString("ascii").split(/[\r\n]+/),a=!1,f=0;for(;f<s.length;)if((u=t(s[f++]))&&"putty-user-key-file-2"===u[0].toLowerCase()){a=!0;break}if(!a)throw new Error("No PuTTY format first line found");var l=u[1];u=t(s[f++]),e.equal(u[0].toLowerCase(),"encryption"),u=t(s[f++]),e.equal(u[0].toLowerCase(),"comment");var c=u[1];u=t(s[f++]),e.equal(u[0].toLowerCase(),"public-lines");var h=parseInt(u[1],10);if(!isFinite(h)||h<0||h>s.length)throw new Error("Invalid public-lines count");var m=r.from(s.slice(f,f+h).join(""),"base64"),p=i.algToKeyType(l),w=i.read(m);if(w.type!==p)throw new Error("Outer key algorithm mismatch");return w.comment=c,w},write:function(t,o){if(e.object(t),!n.isKey(t))throw new Error("Must be a public key");var u=i.keyTypeToAlg(t),s=i.write(t),a=t.comment||"",f=function(e,r){var i=[],n=0;for(;n<e.length;)i.push(e.slice(n,n+64)),n+=64;return i}(s.toString("base64"));return f.unshift("Public-Lines: "+f.length),f.unshift("Comment: "+a),f.unshift("Encryption: none"),f.unshift("PuTTY-User-Key-File-2: "+u),r.from(f.join("\n")+"\n")}};var e=require("assert-plus"),r=require("safer-buffer").Buffer,i=require("./rfc4253"),n=require("../key");require("../errors");function t(e){var r=e.indexOf(":");if(-1===r)return null;var i=e.slice(0,r);for(++r;" "===e[r];)++r;return[i,e.slice(r)]}