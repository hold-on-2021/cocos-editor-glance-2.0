"use strict";module.exports=function(e,i,r,h){r?r instanceof Function?(h=r,r={}):"string"==typeof r&&(r={encoding:r}):r={};var s,d,l,a=r.Promise||global.Promise,w=t(f(()=>l)),g=c.resolve(e);new a(function(n){o[g]||(o[g]=[]),o[g].push(n),1===o[g].length&&n()}).then(function(){return new a(function(t){n.realpath(e,function(n,c){l=u(s=c||e),t()})})}).then(function(){return new a(function(e){r.mode&&r.chown?e():n.stat(s,function(n,t){n||!t?e():(null==(r=Object.assign({},r)).mode&&(r.mode=t.mode),null==r.chown&&process.getuid&&(r.chown={uid:t.uid,gid:t.gid}),e())})})}).then(function(){return new a(function(e,t){n.open(l,"w",r.mode,function(n,c){d=c,n?t(n):e()})})}).then(function(){return new a(function(e,t){Buffer.isBuffer(i)?n.write(d,i,0,i.length,0,function(n){n?t(n):e()}):null!=i?n.write(d,String(i),0,String(r.encoding||"utf8"),function(n){n?t(n):e()}):e()})}).then(function(){return new a(function(e,t){!1!==r.fsync?n.fsync(d,function(c){c?n.close(d,()=>t(c)):n.close(d,e)}):n.close(d,e)})}).then(function(){if(d=null,r.chown)return new a(function(e,t){n.chown(l,r.chown.uid,r.chown.gid,function(n){n?t(n):e()})})}).then(function(){if(r.mode)return new a(function(e,t){n.chmod(l,r.mode,function(n){n?t(n):e()})})}).then(function(){return new a(function(e,t){n.rename(l,s,function(n){n?t(n):e()})})}).then(function(){w(),h()},function(e){return new a(e=>d?n.close(d,e):e()).then(()=>{w(),n.unlink(l,function(){h(e)})})}).then(function(){o[g].shift(),o[g].length>0?o[g][0]():delete o[g]})},module.exports.sync=function(e,c,o){"string"==typeof o?o={encoding:o}:o||(o={});try{e=n.realpathSync(e)}catch(n){}var i,r=u(e);if(!o.mode||!o.chown)try{var h=n.statSync(e);(o=Object.assign({},o)).mode||(o.mode=h.mode),!o.chown&&process.getuid&&(o.chown={uid:h.uid,gid:h.gid})}catch(n){}var s=f(r),d=t(s);try{i=n.openSync(r,"w",o.mode),Buffer.isBuffer(c)?n.writeSync(i,c,0,c.length,0):null!=c&&n.writeSync(i,String(c),0,String(o.encoding||"utf8")),!1!==o.fsync&&n.fsyncSync(i),n.closeSync(i),o.chown&&n.chownSync(r,o.chown.uid,o.chown.gid),o.mode&&n.chmodSync(r,o.mode),n.renameSync(r,e),d()}catch(e){if(i)try{n.closeSync(i)}catch(n){}throw d(),s(),e}},module.exports._getTmpname=u,module.exports._cleanupOnExit=f;var n=require("graceful-fs"),e=require("imurmurhash"),t=require("signal-exit"),c=require("path"),o={},i=function(){try{return require("worker_threads").threadId}catch(n){return 0}}(),r=0;function u(n){return n+"."+e(__filename).hash(String(process.pid)).hash(String(i)).hash(String(++r)).result()}function f(e){return function(){try{n.unlinkSync("function"==typeof e?e():e)}catch(n){}}}