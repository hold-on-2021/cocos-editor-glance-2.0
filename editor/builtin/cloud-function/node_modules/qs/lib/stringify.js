"use strict";var e=require("./utils"),r=require("./formats"),t={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},n=Date.prototype.toISOString,o={delimiter:"&",encode:!0,encoder:e.encode,encodeValuesOnly:!1,serializeDate:function(e){return n.call(e)},skipNulls:!1,strictNullHandling:!1},i=function r(t,n,i,l,a,c,f,s,u,d,y,p){var v=t;if("function"==typeof f)v=f(n,v);else if(v instanceof Date)v=d(v);else if(null===v){if(l)return c&&!p?c(n,o.encoder):n;v=""}if("string"==typeof v||"number"==typeof v||"boolean"==typeof v||e.isBuffer(v))return c?[y(p?n:c(n,o.encoder))+"="+y(c(v,o.encoder))]:[y(n)+"="+y(String(v))];var m,b=[];if(void 0===v)return b;if(Array.isArray(f))m=f;else{var g=Object.keys(v);m=s?g.sort(s):g}for(var O=0;O<m.length;++O){var k=m[O];a&&null===v[k]||(b=Array.isArray(v)?b.concat(r(v[k],i(n,k),i,l,a,c,f,s,u,d,y,p)):b.concat(r(v[k],n+(u?"."+k:"["+k+"]"),i,l,a,c,f,s,u,d,y,p)))}return b};module.exports=function(n,l){var a=n,c=l?e.assign({},l):{};if(null!==c.encoder&&void 0!==c.encoder&&"function"!=typeof c.encoder)throw new TypeError("Encoder has to be a function.");var f=void 0===c.delimiter?o.delimiter:c.delimiter,s="boolean"==typeof c.strictNullHandling?c.strictNullHandling:o.strictNullHandling,u="boolean"==typeof c.skipNulls?c.skipNulls:o.skipNulls,d="boolean"==typeof c.encode?c.encode:o.encode,y="function"==typeof c.encoder?c.encoder:o.encoder,p="function"==typeof c.sort?c.sort:null,v=void 0!==c.allowDots&&c.allowDots,m="function"==typeof c.serializeDate?c.serializeDate:o.serializeDate,b="boolean"==typeof c.encodeValuesOnly?c.encodeValuesOnly:o.encodeValuesOnly;if(void 0===c.format)c.format=r.default;else if(!Object.prototype.hasOwnProperty.call(r.formatters,c.format))throw new TypeError("Unknown format option provided.");var g,O,k=r.formatters[c.format];"function"==typeof c.filter?a=(O=c.filter)("",a):Array.isArray(c.filter)&&(g=O=c.filter);var w,D=[];if("object"!=typeof a||null===a)return"";w=c.arrayFormat in t?c.arrayFormat:"indices"in c?c.indices?"indices":"repeat":"indices";var N=t[w];g||(g=Object.keys(a)),p&&g.sort(p);for(var h=0;h<g.length;++h){var A=g[h];u&&null===a[A]||(D=D.concat(i(a[A],A,N,s,u,d?y:null,O,p,v,m,k,b)))}var j=D.join(f),z=!0===c.addQueryPrefix?"?":"";return j.length>0?z+j:""};