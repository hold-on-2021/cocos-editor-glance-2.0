"use strict";var e=require("./utils"),t=Object.prototype.hasOwnProperty,r={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:e.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},i=function(e,r,i){if(e){var l=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(l),n=a?l.slice(0,a.index):l,c=[];if(n){if(!i.plainObjects&&t.call(Object.prototype,n)&&!i.allowPrototypes)return;c.push(n)}for(var p=0;null!==(a=o.exec(l))&&p<i.depth;){if(p+=1,!i.plainObjects&&t.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+l.slice(a.index)+"]"),function(e,t,r){for(var i=t,l=e.length-1;l>=0;--l){var o,a=e[l];if("[]"===a)o=(o=[]).concat(i);else{o=r.plainObjects?Object.create(null):{};var n="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(n,10);!isNaN(c)&&a!==n&&String(c)===n&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(o=[])[c]=i:o[n]=i}i=o}return i}(c,r,i)}};module.exports=function(l,o){var a=o?e.assign({},o):{};if(null!==a.decoder&&void 0!==a.decoder&&"function"!=typeof a.decoder)throw new TypeError("Decoder has to be a function.");if(a.ignoreQueryPrefix=!0===a.ignoreQueryPrefix,a.delimiter="string"==typeof a.delimiter||e.isRegExp(a.delimiter)?a.delimiter:r.delimiter,a.depth="number"==typeof a.depth?a.depth:r.depth,a.arrayLimit="number"==typeof a.arrayLimit?a.arrayLimit:r.arrayLimit,a.parseArrays=!1!==a.parseArrays,a.decoder="function"==typeof a.decoder?a.decoder:r.decoder,a.allowDots="boolean"==typeof a.allowDots?a.allowDots:r.allowDots,a.plainObjects="boolean"==typeof a.plainObjects?a.plainObjects:r.plainObjects,a.allowPrototypes="boolean"==typeof a.allowPrototypes?a.allowPrototypes:r.allowPrototypes,a.parameterLimit="number"==typeof a.parameterLimit?a.parameterLimit:r.parameterLimit,a.strictNullHandling="boolean"==typeof a.strictNullHandling?a.strictNullHandling:r.strictNullHandling,""===l||null===l||void 0===l)return a.plainObjects?Object.create(null):{};for(var n="string"==typeof l?function(e,i){for(var l={},o=i.ignoreQueryPrefix?e.replace(/^\?/,""):e,a=i.parameterLimit===1/0?void 0:i.parameterLimit,n=o.split(i.delimiter,a),c=0;c<n.length;++c){var p,s,d=n[c],u=d.indexOf("]="),y=-1===u?d.indexOf("="):u+1;-1===y?(p=i.decoder(d,r.decoder),s=i.strictNullHandling?null:""):(p=i.decoder(d.slice(0,y),r.decoder),s=i.decoder(d.slice(y+1),r.decoder)),t.call(l,p)?l[p]=[].concat(l[p]).concat(s):l[p]=s}return l}(l,a):l,c=a.plainObjects?Object.create(null):{},p=Object.keys(n),s=0;s<p.length;++s){var d=p[s],u=i(d,n[d],a);c=e.merge(c,u,a)}return e.compact(c)};