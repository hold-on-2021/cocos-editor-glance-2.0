"use strict";module.exports=function(e,r,a){var t="",s=!0===e.schema.$async,o=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),l=e.self._getId(e.schema);if(e.opts.strictKeywords){var i=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(i){var n="unknown keyword: "+i;if("log"!==e.opts.strictKeywords)throw new Error(n);e.logger.warn(n)}}if(e.isTop&&(t+=" var validate = ",s&&(e.async=!0,t+="async "),t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",l&&(e.opts.sourceCode||e.opts.processCode)&&(t+=" /*# sourceURL="+l+" */ ")),"boolean"==typeof e.schema||!o&&!e.schema.$ref){var f=e.level,h=e.dataLevel,c=e.schema["false schema"],u=e.schemaPath+e.util.getProperty("false schema"),p=e.errSchemaPath+"/false schema",d=!e.opts.allErrors,m="data"+(h||""),v="valid"+f;if(!1===e.schema){e.isTop?d=!0:t+=" var "+v+" = false; ",(Z=Z||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(t+=" , message: 'boolean schema is false' "),e.opts.verbose&&(t+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";var y=t;t=Z.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?t+=s?" return data; ":" validate.errors = null; return true; ":t+=" var "+v+" = true; ";return e.isTop&&(t+=" }; return validate; "),t}if(e.isTop){var g=e.isTop;f=e.level=0,h=e.dataLevel=0,m="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){var w="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw new Error(w);e.logger.warn(w)}t+=" var vErrors = null; ",t+=" var errors = 0;     ",t+=" if (rootData === undefined) rootData = data; "}else{f=e.level,m="data"+((h=e.dataLevel)||"");if(l&&(e.baseId=e.resolve.url(e.baseId,l)),s&&!e.async)throw new Error("async schema in sync schema");t+=" var errs_"+f+" = errors;"}v="valid"+f,d=!e.opts.allErrors;var E,P="",b="",D=e.schema.type,S=Array.isArray(D);if(D&&e.opts.nullable&&!0===e.schema.nullable&&(S?-1==D.indexOf("null")&&(D=D.concat("null")):"null"!=D&&(D=[D,"null"],S=!0)),S&&1==D.length&&(D=D[0],S=!1),e.schema.$ref&&o){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(o=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(t+=" "+e.RULES.all.$comment.code(e,"$comment")),D){if(e.opts.coerceTypes)var R=e.util.coerceToTypes(e.opts.coerceTypes,D);var T=e.RULES.types[D];if(R||S||!0===T||T&&!ee(T)){u=e.schemaPath+".type",p=e.errSchemaPath+"/type",u=e.schemaPath+".type",p=e.errSchemaPath+"/type";var k=S?"checkDataTypes":"checkDataType";if(t+=" if ("+e.util[k](D,m,!0)+") { ",R){var $="dataType"+f,L="coerced"+f;t+=" var "+$+" = typeof "+m+"; ","array"==e.opts.coerceTypes&&(t+=" if ("+$+" == 'object' && Array.isArray("+m+")) "+$+" = 'array'; "),t+=" var "+L+" = undefined; ";var U="",j=R;if(j)for(var A,I=-1,x=j.length-1;I<x;)A=j[I+=1],I&&(t+=" if ("+L+" === undefined) { ",U+="}"),"array"==e.opts.coerceTypes&&"array"!=A&&(t+=" if ("+$+" == 'array' && "+m+".length == 1) { "+L+" = "+m+" = "+m+"[0]; "+$+" = typeof "+m+";  } "),"string"==A?t+=" if ("+$+" == 'number' || "+$+" == 'boolean') "+L+" = '' + "+m+"; else if ("+m+" === null) "+L+" = ''; ":"number"==A||"integer"==A?(t+=" if ("+$+" == 'boolean' || "+m+" === null || ("+$+" == 'string' && "+m+" && "+m+" == +"+m+" ","integer"==A&&(t+=" && !("+m+" % 1)"),t+=")) "+L+" = +"+m+"; "):"boolean"==A?t+=" if ("+m+" === 'false' || "+m+" === 0 || "+m+" === null) "+L+" = false; else if ("+m+" === 'true' || "+m+" === 1) "+L+" = true; ":"null"==A?t+=" if ("+m+" === '' || "+m+" === 0 || "+m+" === false) "+L+" = null; ":"array"==e.opts.coerceTypes&&"array"==A&&(t+=" if ("+$+" == 'string' || "+$+" == 'number' || "+$+" == 'boolean' || "+m+" == null) "+L+" = ["+m+"]; ");t+=" "+U+" if ("+L+" === undefined) {   ",(Z=Z||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",t+=S?""+D.join(","):""+D,t+="' } ",!1!==e.opts.messages&&(t+=" , message: 'should be ",t+=S?""+D.join(","):""+D,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";y=t;t=Z.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } else {  ";var _=h?"data"+(h-1||""):"parentData",C=h?e.dataPathArr[h]:"parentDataProperty";t+=" "+m+" = "+L+"; ",h||(t+="if ("+_+" !== undefined)"),t+=" "+_+"["+C+"] = "+L+"; } "}else{(Z=Z||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",t+=S?""+D.join(","):""+D,t+="' } ",!1!==e.opts.messages&&(t+=" , message: 'should be ",t+=S?""+D.join(","):""+D,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";y=t;t=Z.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(e.schema.$ref&&!o)t+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",d&&(t+=" } if (errors === ",t+=g?"0":"errs_"+f,t+=") { ",b+="}");else{var V=e.RULES;if(V)for(var O=-1,Q=V.length-1;O<Q;)if(ee(T=V[O+=1])){if(T.type&&(t+=" if ("+e.util.checkDataType(T.type,m)+") { "),e.opts.useDefaults)if("object"==T.type&&e.schema.properties){c=e.schema.properties;var J=Object.keys(c);if(J)for(var K,N=-1,H=J.length-1;N<H;){if(void 0!==(B=c[K=J[N+=1]]).default){var q=m+e.util.getProperty(K);if(e.compositeRule){if(e.opts.strictDefaults){w="default is ignored for: "+q;if("log"!==e.opts.strictDefaults)throw new Error(w);e.logger.warn(w)}}else t+=" if ("+q+" === undefined ","empty"==e.opts.useDefaults&&(t+=" || "+q+" === null || "+q+" === '' "),t+=" ) "+q+" = ","shared"==e.opts.useDefaults?t+=" "+e.useDefault(B.default)+" ":t+=" "+JSON.stringify(B.default)+" ",t+="; "}}}else if("array"==T.type&&Array.isArray(e.schema.items)){var z=e.schema.items;if(z){I=-1;for(var B,F=z.length-1;I<F;)if(void 0!==(B=z[I+=1]).default){q=m+"["+I+"]";if(e.compositeRule){if(e.opts.strictDefaults){w="default is ignored for: "+q;if("log"!==e.opts.strictDefaults)throw new Error(w);e.logger.warn(w)}}else t+=" if ("+q+" === undefined ","empty"==e.opts.useDefaults&&(t+=" || "+q+" === null || "+q+" === '' "),t+=" ) "+q+" = ","shared"==e.opts.useDefaults?t+=" "+e.useDefault(B.default)+" ":t+=" "+JSON.stringify(B.default)+" ",t+="; "}}}var G=T.rules;if(G)for(var M,W=-1,X=G.length-1;W<X;)if(re(M=G[W+=1])){var Y=M.code(e,M.keyword,T.type);Y&&(t+=" "+Y+" ",d&&(P+="}"))}if(d&&(t+=" "+P+" ",P=""),T.type&&(t+=" } ",D&&D===T.type&&!R)){t+=" else { ";var Z;u=e.schemaPath+".type",p=e.errSchemaPath+"/type";(Z=Z||[]).push(t),t="",!1!==e.createErrors?(t+=" { keyword: '"+(E||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",t+=S?""+D.join(","):""+D,t+="' } ",!1!==e.opts.messages&&(t+=" , message: 'should be ",t+=S?""+D.join(","):""+D,t+="' "),e.opts.verbose&&(t+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),t+=" } "):t+=" {} ";y=t;t=Z.pop(),!e.compositeRule&&d?e.async?t+=" throw new ValidationError(["+y+"]); ":t+=" validate.errors = ["+y+"]; return false; ":t+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t+=" } "}d&&(t+=" if (errors === ",t+=g?"0":"errs_"+f,t+=") { ",b+="}")}}function ee(e){for(var r=e.rules,a=0;a<r.length;a++)if(re(r[a]))return!0}function re(r){return void 0!==e.schema[r.keyword]||r.implements&&function(r){for(var a=r.implements,t=0;t<a.length;t++)if(void 0!==e.schema[a[t]])return!0}(r)}return d&&(t+=" "+b+" "),g?(s?(t+=" if (errors === 0) return data;           ",t+=" else throw new ValidationError(vErrors); "):(t+=" validate.errors = vErrors; ",t+=" return errors === 0;       "),t+=" }; return validate;"):t+=" var "+v+" = errors === errs_"+f+";",t=e.util.cleanUpCode(t),g&&(t=e.util.finalCleanUpCode(t,s)),t};