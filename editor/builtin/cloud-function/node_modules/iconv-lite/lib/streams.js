"use strict";var t=require("buffer").Buffer,n=require("stream").Transform;function e(t,e){this.conv=t,(e=e||{}).decodeStrings=!1,n.call(this,e)}function o(t,e){this.conv=t,(e=e||{}).encoding=this.encoding="utf8",n.call(this,e)}module.exports=function(t){t.encodeStream=function(n,o){return new e(t.getEncoder(n,o),o)},t.decodeStream=function(n,e){return new o(t.getDecoder(n,e),e)},t.supportsStreams=!0,t.IconvLiteEncoderStream=e,t.IconvLiteDecoderStream=o,t._collect=o.prototype.collect},e.prototype=Object.create(n.prototype,{constructor:{value:e}}),e.prototype._transform=function(t,n,e){if("string"!=typeof t)return e(new Error("Iconv encoding stream needs strings as its input."));try{var o=this.conv.write(t);o&&o.length&&this.push(o),e()}catch(t){e(t)}},e.prototype._flush=function(t){try{var n=this.conv.end();n&&n.length&&this.push(n),t()}catch(n){t(n)}},e.prototype.collect=function(n){var e=[];return this.on("error",n),this.on("data",function(t){e.push(t)}),this.on("end",function(){n(null,t.concat(e))}),this},o.prototype=Object.create(n.prototype,{constructor:{value:o}}),o.prototype._transform=function(n,e,o){if(!t.isBuffer(n))return o(new Error("Iconv decoding stream needs buffers as its input."));try{var r=this.conv.write(n);r&&r.length&&this.push(r,this.encoding),o()}catch(t){o(t)}},o.prototype._flush=function(t){try{var n=this.conv.end();n&&n.length&&this.push(n,this.encoding),t()}catch(n){t(n)}},o.prototype.collect=function(t){var n="";return this.on("error",t),this.on("data",function(t){n+=t}),this.on("end",function(){t(null,n)}),this};