"use strict";var t=require("safer-buffer").Buffer;function e(t,e){this.iconv=e,this.bomAware=!0,this.isLE=t.isLE}function i(t,e){this.isLE=e.isLE,this.highSurrogate=0}function r(t,e){this.isLE=e.isLE,this.badChar=e.iconv.defaultCharUnicode.charCodeAt(0),this.overflow=null}function o(t,e){this.iconv=e}function n(t,e){void 0===(t=t||{}).addBOM&&(t.addBOM=!0),this.encoder=e.iconv.getEncoder(t.defaultEncoding||"utf-32le",t)}function s(t,e){this.decoder=null,this.initialBytes=[],this.initialBytesLen=0,this.options=t||{},this.iconv=e.iconv}function h(t,e){var i=e||"utf-32le";if(t.length>=4)if(65279===t.readUInt32BE(0))i="utf-32be";else if(65279===t.readUInt32LE(0))i="utf-32le";else{for(var r=0,o=0,n=0,s=0,h=Math.min(t.length-t.length%4,128),u=0;u<h;u+=4){var c=t[u],l=t[u+1],a=t[u+2],f=t[u+3];(0!==c||l>16)&&++o,(0!==f||a>16)&&++r,0===c&&0===l&&0===a&&0!==f&&s++,0!==c&&0===l&&0===a&&0===f&&n++}o<r?i="utf-32be":r<o&&(i="utf-32le"),s>n?i="utf-32be":s<n&&(i="utf-32le")}return i}exports._utf32=e,exports.utf32le={type:"_utf32",isLE:!0},exports.utf32be={type:"_utf32",isLE:!1},exports.ucs4le="utf32le",exports.ucs4be="utf32be",e.prototype.encoder=i,e.prototype.decoder=r,i.prototype.write=function(e){for(var i=t.from(e,"ucs2"),r=t.alloc(2*i.length),o=this.isLE?r.writeUInt32LE:r.writeUInt32BE,n=0,s=0;s<i.length;s+=2){var h=i.readUInt16LE(s),u=55296<=h&&h<56320,c=56320<=h&&h<57344;if(this.highSurrogate){if(!u&&c){var l=65536+(this.highSurrogate-55296<<10|h-56320);o.call(r,l,n),n+=4,this.highSurrogate=0;continue}o.call(r,this.highSurrogate,n),n+=4}u?this.highSurrogate=h:(o.call(r,h,n),n+=4,this.highSurrogate=0)}return n<r.length&&(r=r.slice(0,n)),r},i.prototype.end=function(){if(this.highSurrogate){var e=t.alloc(4);return this.isLE?e.writeUInt32LE(this.highSurrogate,0):e.writeUInt32BE(this.highSurrogate,0),this.highSurrogate=0,e}},r.prototype.write=function(e){if(0===e.length)return"";this.overflow&&(e=t.concat([this.overflow,e]));var i=e.length-e.length%4;e.length!==i?(this.overflow=e.slice(i),e=e.slice(0,i)):this.overflow=null;for(var r=t.alloc(i),o=0,n=0;n<i;n+=4){var s=this.isLE?e.readUInt32LE(n):e.readUInt32BE(n);if(s<65536)r.writeUInt16LE(s,o),o+=2;else if(s>1114111)r.writeUInt16LE(this.badChar,o),o+=2;else{var h=55296|(s-=65536)>>10,u=56320+(1023&s);r.writeUInt16LE(h,o),o+=2,r.writeUInt16LE(u,o),o+=2}}return r.slice(0,o).toString("ucs2")},r.prototype.end=function(){this.overflow=null},exports.utf32=o,exports.ucs4=o,o.prototype.encoder=n,o.prototype.decoder=s,n.prototype.write=function(t){return this.encoder.write(t)},n.prototype.end=function(){return this.encoder.end()},s.prototype.write=function(e){if(!this.decoder){if(this.initialBytes.push(e),this.initialBytesLen+=e.length,this.initialBytesLen<32)return"";var i=h(t.concat(this.initialBytes),this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(i,this.options),this.initialBytes.length=this.initialBytesLen=0}return this.decoder.write(e)},s.prototype.end=function(){if(!this.decoder){var e=t.concat(this.initialBytes),i=h(e,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(i,this.options);var r=this.decoder.write(e),o=this.decoder.end();return o?r+o:r}return this.decoder.end()};