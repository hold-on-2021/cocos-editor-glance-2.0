"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@nodelib/fs.stat"),e=require("run-parallel"),r=require("../constants"),n=require("../utils");function i(t,r,i){r.fs.readdir(t,{withFileTypes:!0},(s,u)=>{if(null!==s)return a(i,s);const l=u.map(e=>({dirent:e,name:e.name,path:`${t}${r.pathSegmentSeparator}${e.name}`}));if(!r.followSymbolicLinks)return o(i,l);const f=l.map(t=>(function(t,e){return r=>{if(!t.dirent.isSymbolicLink())return r(null,t);e.fs.stat(t.path,(i,s)=>null!==i?e.throwErrorOnBrokenSymbolicLink?r(i):r(null,t):(t.dirent=n.fs.createDirentFromStats(t.name,s),r(null,t)))}})(t,r));e(f,(t,e)=>{if(null!==t)return a(i,t);o(i,e)})})}function s(r,i,s){i.fs.readdir(r,(u,l)=>{if(null!==u)return a(s,u);const f=l.map(t=>`${r}${i.pathSegmentSeparator}${t}`),c=f.map(e=>r=>t.stat(e,i.fsStatSettings,r));e(c,(t,e)=>{if(null!==t)return a(s,t);const r=[];l.forEach((t,s)=>{const a=e[s],o={name:t,path:f[s],dirent:n.fs.createDirentFromStats(t,a)};i.stats&&(o.stats=a),r.push(o)}),o(s,r)})})}function a(t,e){t(e)}function o(t,e){t(null,e)}exports.read=function(t,e,n){return!e.stats&&r.IS_SUPPORT_READDIR_WITH_FILE_TYPES?i(t,e,n):s(t,e,n)},exports.readdirWithFileTypes=i,exports.readdir=s;