var r=require("concat-map"),t=require("balanced-match");module.exports=function(v){if(!v)return[];"{}"===v.substr(0,2)&&(v="\\{\\}"+v.substr(2));return function n(a,i){var o=[];var p=t("{","}",a);if(!p||/\$$/.test(p.pre))return[a];var v=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(p.body);var d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(p.body);var c=v||d;var g=p.body.indexOf(",")>=0;if(!c&&!g)return p.post.match(/,.*\}/)?(a=p.pre+"{"+p.body+e+p.post,n(a)):[a];var m;if(c)m=p.body.split(/\.\./);else if(1===(m=function r(n){if(!n)return[""];var a=[];var e=t("{","}",n);if(!e)return n.split(",");var i=e.pre;var o=e.body;var s=e.post;var p=i.split(",");p[p.length-1]+="{"+o+"}";var u=r(s);s.length&&(p[p.length-1]+=u.shift(),p.push.apply(p,u));a.push.apply(a,p);return a}(p.body)).length&&1===(m=n(m[0],!1).map(u)).length){var b=p.post.length?n(p.post,!1):[""];return b.map(function(r){return p.pre+m[0]+r})}var j=p.pre;var b=p.post.length?n(p.post,!1):[""];var y;if(c){var M=s(m[0]),A=s(m[1]),C=Math.max(m[0].length,m[1].length),O=3==m.length?Math.abs(s(m[2])):1,S=f,$=A<M;$&&(O*=-1,S=h);var x=m.some(l);y=[];for(var E=M;S(E,A);E+=O){var I;if(d)"\\"===(I=String.fromCharCode(E))&&(I="");else if(I=String(E),x){var q=C-I.length;if(q>0){var z=new Array(q+1).join("0");I=E<0?"-"+z+I.slice(1):z+I}}y.push(I)}}else y=r(m,function(r){return n(r,!1)});for(var L=0;L<y.length;L++)for(var P=0;P<b.length;P++){var Z=j+y[L]+b[P];(!i||c||Z)&&o.push(Z)}return o}(function(r){return r.split("\\\\").join(n).split("\\{").join(a).split("\\}").join(e).split("\\,").join(i).split("\\.").join(o)}(v),!0).map(p)};var n="\0SLASH"+Math.random()+"\0",a="\0OPEN"+Math.random()+"\0",e="\0CLOSE"+Math.random()+"\0",i="\0COMMA"+Math.random()+"\0",o="\0PERIOD"+Math.random()+"\0";function s(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function p(r){return r.split(n).join("\\").split(a).join("{").split(e).join("}").split(i).join(",").split(o).join(".")}function u(r){return"{"+r+"}"}function l(r){return/^-?0\d/.test(r)}function f(r,t){return r<=t}function h(r,t){return r>=t}