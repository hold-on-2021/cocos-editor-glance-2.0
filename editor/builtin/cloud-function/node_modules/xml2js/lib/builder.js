(function(){"use strict";var t,e,o,i,r,n={}.hasOwnProperty;t=require("xmlbuilder"),e=require("./defaults").defaults,i=function(t){return"string"==typeof t&&(t.indexOf("&")>=0||t.indexOf(">")>=0||t.indexOf("<")>=0)},r=function(t){return"<![CDATA["+o(t)+"]]>"},o=function(t){return t.replace("]]>","]]]]><![CDATA[>")},exports.Builder=function(){function o(t){var o,i,r;for(o in this.options={},i=e[.2])n.call(i,o)&&(r=i[o],this.options[o]=r);for(o in t)n.call(t,o)&&(r=t[o],this.options[o]=r)}return o.prototype.buildObject=function(o){var s,a,l,p,f;return s=this.options.attrkey,a=this.options.charkey,1===Object.keys(o).length&&this.options.rootName===e[.2].rootName?o=o[f=Object.keys(o)[0]]:f=this.options.rootName,l=function(t){return function(e,o){var p,f,u,c,h,d;if("object"!=typeof o)t.options.cdata&&i(o)?e.raw(r(o)):e.txt(o);else if(Array.isArray(o)){for(c in o)if(n.call(o,c))for(h in f=o[c])u=f[h],e=l(e.ele(h),u).up()}else for(h in o)if(n.call(o,h))if(f=o[h],h===s){if("object"==typeof f)for(p in f)d=f[p],e=e.att(p,d)}else if(h===a)e=t.options.cdata&&i(f)?e.raw(r(f)):e.txt(f);else if(Array.isArray(f))for(c in f)n.call(f,c)&&(e="string"==typeof(u=f[c])?t.options.cdata&&i(u)?e.ele(h).raw(r(u)).up():e.ele(h,u).up():l(e.ele(h),u).up());else"object"==typeof f?e=l(e.ele(h),f).up():"string"==typeof f&&t.options.cdata&&i(f)?e=e.ele(h).raw(r(f)).up():(null==f&&(f=""),e=e.ele(h,f.toString()).up());return e}}(this),p=t.create(f,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),l(p,o).end(this.options.renderOpts)},o}()}).call(this);