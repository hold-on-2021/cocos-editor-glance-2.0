var r=require("./_mapping"),n=require("./placeholder"),t=Array.prototype.push;function e(r,n){return 2==n?function(n,t){return r(n,t)}:function(n){return r(n)}}function u(r){for(var n=r?r.length:0,t=Array(n);n--;)t[n]=r[n];return t}function i(r,n){return function(){var t=arguments.length;if(t){for(var e=Array(t);t--;)e[t]=arguments[t];var u=e[0]=n.apply(void 0,e);return r.apply(void 0,e),u}}}module.exports=function a(o,c,f,p){var l="function"==typeof c,y=c===Object(c);if(y&&(p=f,f=c,c=void 0),null==f)throw new TypeError;p||(p={});var v={cap:!("cap"in p)||p.cap,curry:!("curry"in p)||p.curry,fixed:!("fixed"in p)||p.fixed,immutable:!("immutable"in p)||p.immutable,rearg:!("rearg"in p)||p.rearg},s=l?f:n,h="curry"in p&&p.curry,g="fixed"in p&&p.fixed,d="rearg"in p&&p.rearg,m=l?f.runInContext():void 0,x=l?f:{ary:o.ary,assign:o.assign,clone:o.clone,curry:o.curry,forEach:o.forEach,isArray:o.isArray,isError:o.isError,isFunction:o.isFunction,isWeakMap:o.isWeakMap,iteratee:o.iteratee,keys:o.keys,rearg:o.rearg,toInteger:o.toInteger,toPath:o.toPath},A=x.ary,b=x.assign,k=x.clone,E=x.curry,R=x.forEach,j=x.isArray,I=x.isError,M=x.isFunction,O=x.isWeakMap,F=x.keys,T=x.rearg,C=x.toInteger,P=x.toPath,W=F(r.aryMethod),q={castArray:function(r){return function(){var n=arguments[0];return j(n)?r(u(n)):r.apply(void 0,arguments)}},iteratee:function(r){return function(){var n=arguments[0],t=arguments[1],u=r(n,t),i=u.length;return v.cap&&"number"==typeof t?(t=t>2?t-2:1,i&&i<=t?u:e(u,t)):u}},mixin:function(r){return function(n){var t=this;if(!M(t))return r(t,Object(n));var e=[];return R(F(n),function(r){M(n[r])&&e.push([r,t.prototype[r]])}),r(t,Object(n)),R(e,function(r){var n=r[1];M(n)?t.prototype[r[0]]=n:delete t.prototype[r[0]]}),t}},nthArg:function(r){return function(n){var t=n<0?1:C(n)+1;return E(r(n),t)}},rearg:function(r){return function(n,t){var e=t?t.length:0;return E(r(n,t),e)}},runInContext:function(r){return function(n){return a(o,r(n),p)}}};function w(n,t){if(v.cap){var u=r.iterateeRearg[n];if(u)return function(r,n){return D(r,function(r){var t=n.length;return function(r,n){return 2==n?function(n,t){return r.apply(void 0,arguments)}:function(n){return r.apply(void 0,arguments)}}(T(e(r,t),n),t)})}(t,u);var i=!l&&r.iterateeAry[n];if(i)return function(r,n){return D(r,function(r){return"function"==typeof r?e(r,n):r})}(t,i)}return t}function S(n,e,u){if(v.fixed&&(g||!r.skipFixed[n])){var i=r.methodSpread[n],a=i&&i.start;return void 0===a?A(e,u):function(r,n){return function(){for(var e=arguments.length,u=e-1,i=Array(e);e--;)i[e]=arguments[e];var a=i[n],o=i.slice(0,n);return a&&t.apply(o,a),n!=u&&t.apply(o,i.slice(n+1)),r.apply(this,o)}}(e,a)}return e}function _(n,t,e){return v.rearg&&e>1&&(d||!r.skipRearg[n])?T(t,r.methodRearg[n]||r.aryRearg[e]):t}function z(r,n){for(var t=-1,e=(n=P(n)).length,u=e-1,i=k(Object(r)),a=i;null!=a&&++t<e;){var o=n[t],c=a[o];null==c||M(c)||I(c)||O(c)||(a[o]=k(t==u?c:Object(c))),a=a[o]}return i}function B(n,t){var e=r.aliasToReal[n]||n,u=r.remap[e]||e,i=p;return function(r){var n=l?m:x,o=l?m[u]:t,c=b(b({},i),r);return a(n,e,o,c)}}function D(r,n){return function(){var t=arguments.length;if(!t)return r();for(var e=Array(t);t--;)e[t]=arguments[t];var u=v.rearg?0:t-1;return e[u]=n(e[u]),r.apply(void 0,e)}}function G(n,t,e){var a,o=r.aliasToReal[n]||n,c=t,f=q[o];return f?c=f(t):v.immutable&&(r.mutate.array[o]?c=i(t,u):r.mutate.object[o]?c=i(t,function(r){return function(n){return r({},n)}}(t)):r.mutate.set[o]&&(c=i(t,z))),R(W,function(n){return R(r.aryMethod[n],function(t){if(o==t){var e=r.methodSpread[o],u=e&&e.afterRearg;return a=u?S(o,_(o,c,n),n):_(o,S(o,c,n),n),a=function(r,n,t){return h||v.curry&&t>1?E(n,t):n}(0,a=w(o,a),n),!1}}),!a}),a||(a=c),a==t&&(a=h?E(a,1):function(){return t.apply(this,arguments)}),a.convert=B(o,t),a.placeholder=t.placeholder=e,a}if(!y)return G(c,f,s);var H=f,J=[];return R(W,function(n){R(r.aryMethod[n],function(n){var t=H[r.remap[n]||n];t&&J.push([n,G(n,t,H)])})}),R(F(H),function(r){var n=H[r];if("function"==typeof n){for(var t=J.length;t--;)if(J[t][0]==r)return;n.convert=B(r,n),J.push([r,n])}}),R(J,function(r){H[r[0]]=r[1]}),H.convert=function(r){return H.runInContext.convert(r)(void 0)},H.placeholder=H,R(F(H),function(n){R(r.realToAlias[n]||[],function(r){H[r]=H[n]})}),H};