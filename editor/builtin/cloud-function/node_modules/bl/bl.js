"use strict";const t=require("readable-stream").Duplex,i=require("util"),e=require("./BufferList");function n(i){if(!(this instanceof n))return new n(i);if("function"==typeof i){this._callback=i;const t=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(i){i.on("error",t)}),this.on("unpipe",function(i){i.removeListener("error",t)}),i=null}e._init.call(this,i),t.call(this)}i.inherits(n,t),Object.assign(n.prototype,e.prototype),n.prototype._new=function(t){return new n(t)},n.prototype._write=function(t,i,e){this._appendBuffer(t),"function"==typeof e&&e()},n.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},n.prototype.end=function(i){t.prototype.end.call(this,i),this._callback&&(this._callback(null,this.slice()),this._callback=null)},n.prototype._destroy=function(t,i){this._bufs.length=0,this.length=0,i(t)},n.prototype._isBufferList=function(t){return t instanceof n||t instanceof e||n.isBufferList(t)},n.isBufferList=e.isBufferList,module.exports=n,module.exports.BufferListStream=n,module.exports.BufferList=e;