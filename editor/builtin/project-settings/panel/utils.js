"use strict";const e=require("fire-fs"),{dirname:t,join:i}=require("path"),o=Editor.require("app://share/engine-utils");let s=null;exports.profiles={project:null,global:null,local:null},exports.init=function(){exports.profiles.project=Editor.Profile.load("project://project.json"),exports.profiles.global=Editor.Profile.load("global://settings.json"),exports.profiles.local=Editor.Profile.load("local://settings.json"),function(){let e=exports.profiles.global,t=e.get("use-default-cpp-engine");s=o.getSimulatorConfigAt(!t&&e.get("cpp-engine-path"))}()};exports.queryGroupList=function(){let e=[],t=exports.profiles.project.get("group-list");return t?(t.forEach(t=>{e.push(t)}),exports.profiles.project.set("group-list",t),e):e},exports.queryCollision=function(){let e=exports.profiles.project.get("collision-matrix")||[];return JSON.parse(JSON.stringify(e))},exports.queryExcluded=function(){let e=exports.profiles.project.get("excluded-modules")||[];return JSON.parse(JSON.stringify(e))},exports.queryPreview=function(){return{scene:exports.profiles.project.get("start-scene")||"current",resolutionWidth:exports.profiles.project.get("design-resolution-width"),resolutionHeight:exports.profiles.project.get("design-resolution-height"),fitWidth:exports.profiles.project.get("fit-width"),fitHeight:exports.profiles.project.get("fit-height")}},exports.querySimulator=function(){if(!s)return null;let e,t=exports.profiles.project,i=t.get("use-project-simulator-setting"),o=t.get("simulator-orientation")||s.isLandscape,r=t.get("simulator-resolution")||{},n=t.get("use-customize-simulator"),l=s.simulator_screen_size.map((e,t)=>({index:t,width:e.width,height:e.height,title:e.title}));l.push({index:l.length,title:Editor.T("PREFERENCES.sim_res_custom"),custom:!0,width:r.width,height:r.height}),n?e=l.length-1:l.some((t,i)=>{if(t.width===r.width&&t.height===r.height)return e=i,!0})||(n=!0,e=l.length-1);return{type:i?"project":"global",direction:o?"horizontal":"vertical",resolution:e,resolutionList:l,width:r.width,height:r.height}},exports.queryEngine=function(){let e=exports.profiles.local,t=function(t,i){return void 0===e.get(t)?i:e.get(t)};return{useGlobalSetting:t("use-global-engine-setting",!0),useDefaultJsEngine:t("use-default-js-engine",!0),jsEnginePath:e.get("js-engine-path")||"",useDefaultCppEngine:t("use-default-cpp-engine",!0),cppEnginePath:e.get("cpp-engine-path")||""}},exports.queryFacebook=function(){let e=exports.profiles.project,t=e.get("facebook");return t||(t=e.set("facebook",{})),{enable:t.enable,appID:t.appID,live:t.live,audience:t.audience}};exports.setGroupList=function(e){let t=exports.profiles.project,i=t.get("group-list");for(i||(i=[],t.set("group-list",i));i.length>e.length;)i.pop();e.forEach((e,t)=>{i[t]=e}),t.set("group-list",i)},exports.setCollision=function(e){exports.profiles.project.set("collision-matrix",JSON.parse(JSON.stringify(e)))},exports.setExcluded=function(e){exports.profiles.project.set("excluded-modules",JSON.parse(JSON.stringify(e)))},exports.setPreview=function(e){let t=exports.profiles.project;"current"!==e.scene?t.set("start-scene",e.scene):t.remove("start-scene"),t.set("design-resolution-width",e.resolutionWidth),t.set("design-resolution-height",e.resolutionHeight),t.set("fit-width",e.fitWidth),t.set("fit-height",e.fitHeight)},exports.setSimulator=function(e){let t=exports.profiles.project;t.set("use-project-simulator-setting",!("project"!=e.type)),t.set("simulator-orientation",!("horizontal"!=e.direction)),t.set("use-customize-simulator",!!(e.resolution>=e.resolutionList.length-1)),t.set("simulator-resolution",{width:e.width,height:e.height});let i=s.init_cfg;if("global"===e.type){let t=exports.profiles.global,o=t.get("simulator-resolution"),s=e.resolutionList[o];i.width=s.width,i.height=s.height,i.isLandscape=t.get("simulator-orientation")}else i.width=e.width,i.height=e.height,i.isLandscape=!("horizontal"!=e.direction)},exports.setEngine=function(e){let t=exports.profiles.local;t.set("use-global-engine-setting",e.useGlobalSetting),t.set("use-default-js-engine",e.useDefaultJsEngine),t.set("js-engine-path",e.jsEnginePath),t.set("use-default-cpp-engine",e.useDefaultCppEngine),t.set("cpp-engine-path",e.cppEnginePath)},exports.setFacebook=function(e){let t=exports.profiles.project,i=t.get("facebook");i.enable=e.enable,i.appID=e.appID||"",i.live=e.live||{enable:!1},i.audience=e.audience||{enable:!1},t.set("facebook",i)},exports.save=function(){let i=exports.profiles.local;i.get("use-global-engine-setting")&&(i=exports.profiles.global);let r=o.getSimulatorConfigPath(i.get("use-default-cpp-engine")?void 0:i.get("cpp-engine-path"));e.existsSync(t(r))?e.writeJsonSync(r,s,"utf-8"):Editor.warn("Sorry, save failed. Cannot find simulator config.json under "+r),exports.profiles.project.save(),exports.profiles.local.save(),Editor.Ipc.sendToAll("editor:project-profile-updated")};