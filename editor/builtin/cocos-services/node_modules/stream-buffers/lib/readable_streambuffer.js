var e=require("stream"),t=require("./constants"),i=require("util"),n=module.exports=function(i){var n=this;e.Stream.call(this);var r=(i=i||{}).hasOwnProperty("frequency")?i.frequency:t.DEFAULT_FREQUENCY,a=i.chunkSize||t.DEFAULT_CHUNK_SIZE,l=i.initialSize||t.DEFAULT_INITIAL_SIZE,s=i.incrementAmount||t.DEFAULT_INCREMENT_AMOUNT,u=0,f=new Buffer(l),h=null;this.readable=!0,this.writable=!1;var o=function(){var e=Math.min(a,u);if(e>0){var t=null;h?t=f.toString(h,0,e):(t=new Buffer(e),f.copy(t,0,0,e)),n.emit("data",t),e<f.length&&f.copy(f,0,e,u),u-=e}0!==u||n.readable||(n.emit("end"),n.emit("close"),o&&o.interval&&(clearInterval(o.interval),o.interval=null))};this.size=function(){return u},this.maxSize=function(){return f.length};var c=function(e){if(f.length-u<e){var t=Math.ceil((e-(f.length-u))/s),i=new Buffer(f.length+s*t);f.copy(i,0,0,u),f=i}};this.put=function(e,t){if(n.readable){var i=0===u;if(Buffer.isBuffer(e))c(e.length),e.copy(f,u,0),u+=e.length;else{e+="";var a=Buffer.byteLength(e);c(a),f.write(e,u,t||"utf8"),u+=a}if(i&&u>0&&this.emit("readable"),!this.isPaused&&!r)for(;u>0;)o()}},this.pause=function(){this.isPaused=!0,o&&o.interval&&(clearInterval(o.interval),delete o.interval)},this.resume=function(){this.isPaused=!1,o&&!o.interval&&r>0&&(o.interval=setInterval(o,r))},this.destroy=function(){n.emit("end"),o.interval&&clearInterval(o.interval),o=null,n.readable=!1,n.emit("close")},this.destroySoon=function(){n.readable=!1,o.interval||(n.emit("end"),n.emit("close"))},this.setEncoding=function(e){h=e},this.resume()};i.inherits(n,e.Stream);