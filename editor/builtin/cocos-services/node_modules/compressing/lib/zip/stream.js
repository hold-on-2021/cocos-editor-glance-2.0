"use strict";const e=require("path"),r=require("yazl"),i=require("../tar/stream");module.exports=class extends i{_init(){const e=(this._zipfile=new r.ZipFile).outputStream;e.on("end",()=>this.push(null)),e.on("data",e=>this.push(e)),e.on("error",e=>this.emit("error",e))}_addFileEntry(r,i){this._zipfile.addFile(r,i.relativePath||e.basename(r),i),this._onEntryFinish()}_addBufferEntry(e,r){if(!r.relativePath)return this.emit("error",new Error("opts.relativePath is required if entry is a buffer"));this._zipfile.addBuffer(e,r.relativePath,r),this._onEntryFinish()}_addStreamEntry(e,r){if(!r.relativePath)return this.emit("error",new Error("opts.relativePath is required if entry is a stream"));e.on("error",e=>this.emit("error",e)),this._zipfile.addReadStream(e,r.relativePath,r),this._onEntryFinish()}_finalize(){this._zipfile.end()}};