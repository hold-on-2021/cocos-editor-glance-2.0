require("./pbxProject");var t=require("util"),e=t.format,i="\t",n=/_comment$/,s=require("events").EventEmitter;function r(t,e){var i=e[t+"_comment"];return i||null}function h(t){return t===Object(t)}function o(t){return Array.isArray(t)}function c(t){this.contents=t,this.sync=!1,this.indentLevel=0}t.inherits(c,s),c.prototype.write=function(t){var n=e.apply(null,arguments);this.sync&&(this.buffer+=e("%s%s",function t(e){return e<=0?"":i+t(e-1)}(this.indentLevel),n))},c.prototype.writeFlush=function(t){var e=this.indentLevel;this.indentLevel=0,this.write.apply(this,arguments),this.indentLevel=e},c.prototype.writeSync=function(){return this.sync=!0,this.buffer="",this.writeHeadComment(),this.writeProject(),this.buffer},c.prototype.writeHeadComment=function(){this.contents.headComment&&this.write("// %s\n",this.contents.headComment)},c.prototype.writeProject=function(){var t,e,i,s=this.contents.project;if(this.write("{\n"),s){for(t in this.indentLevel++,s)n.test(t)||(e=r(t,s),o(i=s[t])?this.writeArray(i,t):h(i)?(this.write("%s = {\n",t),this.indentLevel++,"objects"===t?this.writeObjectsSections(i):this.writeObject(i),this.indentLevel--,this.write("};\n")):e?this.write("%s = %s /* %s */;\n",t,i,e):this.write("%s = %s;\n",t,i));this.indentLevel--}this.write("}\n")},c.prototype.writeObject=function(t){var e,i,s;for(e in t)n.test(e)||(s=r(e,t),o(i=t[e])?this.writeArray(i,e):h(i)?(this.write("%s = {\n",e),this.indentLevel++,this.writeObject(i),this.indentLevel--,this.write("};\n")):s?this.write("%s = %s /* %s */;\n",e,i,s):this.write("%s = %s;\n",e,i))},c.prototype.writeObjectsSections=function(t){var e,i,n=!0;for(e in t)n?n=!1:this.writeFlush("\n"),h(i=t[e])&&(this.writeSectionComment(e,!0),this.writeSection(i),this.writeSectionComment(e,!1))},c.prototype.writeArray=function(t,e){var i,n;for(this.write("%s = (\n",e),this.indentLevel++,i=0;i<t.length;i++)(n=t[i]).value&&n.comment?this.write("%s /* %s */,\n",n.value,n.comment):h(n)?(this.write("{\n"),this.indentLevel++,this.writeObject(n),this.indentLevel--,this.write("},\n")):this.write("%s,\n",n);this.indentLevel--,this.write(");\n")},c.prototype.writeSectionComment=function(t,e){e?this.writeFlush("/* Begin %s section */\n",t):this.writeFlush("/* End %s section */\n",t)},c.prototype.writeSection=function(t){var e,i,s;for(e in t)n.test(e)||(s=r(e,t),"PBXBuildFile"==(i=t[e]).isa||"PBXFileReference"==i.isa?this.writeInlineObject(e,s,i):(s?this.write("%s /* %s */ = {\n",e,s):this.write("%s = {\n",e),this.indentLevel++,this.writeObject(i),this.indentLevel--,this.write("};\n")))},c.prototype.writeInlineObject=function(t,i,s){var c=[],w=function(t,i,s){var u,l,p;for(u in i?c.push(e("%s /* %s */ = {",t,i)):c.push(e("%s = {",t)),s)if(!n.test(u))if(l=r(u,s),o(p=s[u])){c.push(e("%s = (",u));for(var f=0;f<p.length;f++)c.push(e("%s, ",p[f]));c.push("); ")}else h(p)?w(u,l,p):l?c.push(e("%s = %s /* %s */; ",u,p,l)):c.push(e("%s = %s; ",u,p));c.push("}; ")};w(t,i,s),this.write("%s\n",c.join("").trim())},module.exports=c;