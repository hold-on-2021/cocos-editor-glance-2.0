var e=require("stream"),n=require("./index"),r=new e.Readable,t=new e.Writable;r._read=function(e){this.push(Buffer(e).fill("abc"))},t._write=function(e,n,r){setTimeout(function(){r()},100)};var o=function(){var e=new(require("stream").Transform);return e._transform=function(n,r,t){e.push(n.toString("hex")),t()},e},i=!1,u=!1,s=!1,f=function(){i&&u&&s&&(console.log("test-browser.js passes"),clearTimeout(a))};if(t.on("finish",function(){i=!0,f()}),r.on("end",function(){u=!0,f()}),n(r,o(),o(),o(),t,function(){s=!0,f()})!==t)throw new Error("should return last stream");setTimeout(function(){r.push(null),r.emit("close")},1e3);var a=setTimeout(function(){throw f(),new Error("timeout")},5e3);