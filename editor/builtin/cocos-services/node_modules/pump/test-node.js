var e=require("./index"),r=require("fs").createReadStream("/dev/random"),t=require("fs").createWriteStream("/dev/null"),n=function(){var e=new(require("stream").Transform);return e._transform=function(r,t,n){e.push(r.toString("hex")),n()},e},o=!1,u=!1,i=!1,s=function(){o&&u&&i&&(console.log("test-node.js passes"),clearTimeout(a))};if(t.on("close",function(){o=!0,s()}),r.on("close",function(){u=!0,s()}),e(r,n(),n(),n(),t,function(){i=!0,s()})!==t)throw new Error("should return last stream");setTimeout(function(){r.destroy()},1e3);var a=setTimeout(function(){throw new Error("timeout")},5e3);