var e=require("once"),r=function(){},n=function(o,t,i){if("function"==typeof t)return n(o,null,t);t||(t={}),i=e(i||r);var l=o._writableState,a=o._readableState,c=t.readable||!1!==t.readable&&o.readable,s=t.writable||!1!==t.writable&&o.writable,u=function(){o.writable||f()},f=function(){s=!1,c||i.call(o)},d=function(){c=!1,s||i.call(o)},m=function(e){i.call(o,e?new Error("exited with error code: "+e):null)},v=function(e){i.call(o,e)},b=function(){return(!c||a&&a.ended)&&(!s||l&&l.ended)?void 0:i.call(o,new Error("premature close"))},L=function(){o.req.on("finish",f)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(o)?s&&!l&&(o.on("end",u),o.on("close",u)):(o.on("complete",f),o.on("abort",b),o.req?L():o.on("request",L)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(o)&&o.on("exit",m),o.on("end",d),o.on("finish",f),!1!==t.error&&o.on("error",v),o.on("close",b),function(){o.removeListener("complete",f),o.removeListener("abort",b),o.removeListener("request",L),o.req&&o.req.removeListener("finish",f),o.removeListener("end",u),o.removeListener("close",u),o.removeListener("finish",f),o.removeListener("exit",m),o.removeListener("end",d),o.removeListener("error",v),o.removeListener("close",b)}};module.exports=n;