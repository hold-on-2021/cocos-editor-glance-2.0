#!/usr/bin/env node
var e=require("minimist")(process.argv.slice(2)),r=require("exec-sh"),i=require("path"),t=require("./main.js");0===e._.length&&(console.error(["Usage: watch <command> [...directory]","[--wait=<seconds>]","[--filter=<file>]","[--interval=<seconds>]","[--ignoreDotFiles]","[--ignoreUnreadable]","[--ignoreDirectoryPattern]"].join(" ")),process.exit());var o,n={},a=e._[0],s=[],c=e._.length;if(c>1)for(o=1;o<c;o++)s.push(e._[o]);else s.push(process.cwd());var l=Number(e.wait||e.w);if((e.interval||e.i)&&(n.interval=Number(e.interval||e.i||.2)),(e.ignoreDotFiles||e.d)&&(n.ignoreDotFiles=!0),(e.ignoreUnreadable||e.u)&&(n.ignoreUnreadableDir=!0),e.ignoreDirectoryPattern||e.p){var g=(e.ignoreDirectoryPattern||e.p).match(/^\/(.*)\/([gimuy]*)$/);n.ignoreDirectoryPattern=new RegExp(g[1],g[2])}if(e.filter||e.f)try{n.filter=require(i.resolve(process.cwd(),e.filter||e.f))}catch(e){console.error(e),process.exit(1)}var f=!1,u=s.length,v=u-1;for(o=0;o<u;o++){var h=s[o];console.error("> Watching",h),t.watchTree(h,n,function(e,i,t){if(v)return v--,void 0;f||(r(a),l>0&&(f=!0,setTimeout(function(){f=!1},1e3*l)))})}