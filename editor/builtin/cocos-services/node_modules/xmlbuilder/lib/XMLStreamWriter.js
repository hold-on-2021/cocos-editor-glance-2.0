(function(){var t,e,i,s,r,n,a,o,h,c,u,l,m,p={}.hasOwnProperty;a=require("./XMLDeclaration"),o=require("./XMLDocType"),t=require("./XMLCData"),e=require("./XMLComment"),h=require("./XMLElement"),u=require("./XMLRaw"),l=require("./XMLText"),c=require("./XMLProcessingInstruction"),i=require("./XMLDTDAttList"),s=require("./XMLDTDElement"),r=require("./XMLDTDEntity"),n=require("./XMLDTDNotation"),m=require("./XMLWriterBase"),module.exports=function(d){function w(t,e){this.stream=t,w.__super__.constructor.call(this,e)}return function(t,e){for(var i in e)p.call(e,i)&&(t[i]=e[i]);function s(){this.constructor=t}return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t}(w,m),w.prototype.document=function(t){var i,s,r,n,h,u,l,m;for(s=0,n=(u=t.children).length;s<n;s++)(i=u[s]).isLastRootNode=!1;for(t.children[t.children.length-1].isLastRootNode=!0,m=[],r=0,h=(l=t.children).length;r<h;r++)switch(i=l[r],!1){case!(i instanceof a):m.push(this.declaration(i));break;case!(i instanceof o):m.push(this.docType(i));break;case!(i instanceof e):m.push(this.comment(i));break;case!(i instanceof c):m.push(this.processingInstruction(i));break;default:m.push(this.element(i))}return m},w.prototype.attribute=function(t){return this.stream.write(" "+t.name+'="'+t.value+'"')},w.prototype.cdata=function(t,e){return this.stream.write(this.space(e)+"<![CDATA["+t.text+"]]>"+this.endline(t))},w.prototype.comment=function(t,e){return this.stream.write(this.space(e)+"\x3c!-- "+t.text+" --\x3e"+this.endline(t))},w.prototype.declaration=function(t,e){return this.stream.write(this.space(e)),this.stream.write('<?xml version="'+t.version+'"'),null!=t.encoding&&this.stream.write(' encoding="'+t.encoding+'"'),null!=t.standalone&&this.stream.write(' standalone="'+t.standalone+'"'),this.stream.write("?>"),this.stream.write(this.endline(t))},w.prototype.docType=function(a,o){var h,u,l,m;if(o||(o=0),this.stream.write(this.space(o)),this.stream.write("<!DOCTYPE "+a.root().name),a.pubID&&a.sysID?this.stream.write(' PUBLIC "'+a.pubID+'" "'+a.sysID+'"'):a.sysID&&this.stream.write(' SYSTEM "'+a.sysID+'"'),a.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(a)),u=0,l=(m=a.children).length;u<l;u++)switch(h=m[u],!1){case!(h instanceof i):this.dtdAttList(h,o+1);break;case!(h instanceof s):this.dtdElement(h,o+1);break;case!(h instanceof r):this.dtdEntity(h,o+1);break;case!(h instanceof n):this.dtdNotation(h,o+1);break;case!(h instanceof t):this.cdata(h,o+1);break;case!(h instanceof e):this.comment(h,o+1);break;case!(h instanceof c):this.processingInstruction(h,o+1);break;default:throw new Error("Unknown DTD node type: "+h.constructor.name)}this.stream.write("]")}return this.stream.write(">"),this.stream.write(this.endline(a))},w.prototype.element=function(i,s){var r,n,a,o,m,d,w,f;for(m in s||(s=0),f=this.space(s),this.stream.write(f+"<"+i.name),d=i.attributes)p.call(d,m)&&(r=d[m],this.attribute(r));if(0===i.children.length||i.children.every(function(t){return""===t.value}))this.allowEmpty?this.stream.write("></"+i.name+">"):this.stream.write("/>");else if(this.pretty&&1===i.children.length&&null!=i.children[0].value)this.stream.write(">"),this.stream.write(i.children[0].value),this.stream.write("</"+i.name+">");else{for(this.stream.write(">"+this.newline),a=0,o=(w=i.children).length;a<o;a++)switch(n=w[a],!1){case!(n instanceof t):this.cdata(n,s+1);break;case!(n instanceof e):this.comment(n,s+1);break;case!(n instanceof h):this.element(n,s+1);break;case!(n instanceof u):this.raw(n,s+1);break;case!(n instanceof l):this.text(n,s+1);break;case!(n instanceof c):this.processingInstruction(n,s+1);break;default:throw new Error("Unknown XML node type: "+n.constructor.name)}this.stream.write(f+"</"+i.name+">")}return this.stream.write(this.endline(i))},w.prototype.processingInstruction=function(t,e){return this.stream.write(this.space(e)+"<?"+t.target),t.value&&this.stream.write(" "+t.value),this.stream.write("?>"+this.endline(t))},w.prototype.raw=function(t,e){return this.stream.write(this.space(e)+t.value+this.endline(t))},w.prototype.text=function(t,e){return this.stream.write(this.space(e)+t.value+this.endline(t))},w.prototype.dtdAttList=function(t,e){return this.stream.write(this.space(e)+"<!ATTLIST "+t.elementName+" "+t.attributeName+" "+t.attributeType),"#DEFAULT"!==t.defaultValueType&&this.stream.write(" "+t.defaultValueType),t.defaultValue&&this.stream.write(' "'+t.defaultValue+'"'),this.stream.write(">"+this.endline(t))},w.prototype.dtdElement=function(t,e){return this.stream.write(this.space(e)+"<!ELEMENT "+t.name+" "+t.value+">"+this.endline(t))},w.prototype.dtdEntity=function(t,e){return this.stream.write(this.space(e)+"<!ENTITY"),t.pe&&this.stream.write(" %"),this.stream.write(" "+t.name),t.value?this.stream.write(' "'+t.value+'"'):(t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),t.nData&&this.stream.write(" NDATA "+t.nData)),this.stream.write(">"+this.endline(t))},w.prototype.dtdNotation=function(t,e){return this.stream.write(this.space(e)+"<!NOTATION "+t.name),t.pubID&&t.sysID?this.stream.write(' PUBLIC "'+t.pubID+'" "'+t.sysID+'"'):t.pubID?this.stream.write(' PUBLIC "'+t.pubID+'"'):t.sysID&&this.stream.write(' SYSTEM "'+t.sysID+'"'),this.stream.write(">"+this.endline(t))},w.prototype.endline=function(t){return t.isLastRootNode?"":this.newline},w}()}).call(this);