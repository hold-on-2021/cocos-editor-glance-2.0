(function(){var e,t,n,i,r,s,o,a,c,u,l,h,p,f={}.hasOwnProperty;o=require("./XMLDeclaration"),a=require("./XMLDocType"),e=require("./XMLCData"),t=require("./XMLComment"),c=require("./XMLElement"),l=require("./XMLRaw"),h=require("./XMLText"),u=require("./XMLProcessingInstruction"),n=require("./XMLDTDAttList"),i=require("./XMLDTDElement"),r=require("./XMLDTDEntity"),s=require("./XMLDTDNotation"),p=require("./XMLWriterBase"),module.exports=function(d){function y(e){y.__super__.constructor.call(this,e)}return function(e,t){for(var n in t)f.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e}(y,p),y.prototype.document=function(e){var n,i,r,s,c;for(s="",i=0,r=(c=e.children).length;i<r;i++)n=c[i],s+=function(){switch(!1){case!(n instanceof o):return this.declaration(n);case!(n instanceof a):return this.docType(n);case!(n instanceof t):return this.comment(n);case!(n instanceof u):return this.processingInstruction(n);default:return this.element(n,0)}}.call(this);return this.pretty&&s.slice(-this.newline.length)===this.newline&&(s=s.slice(0,-this.newline.length)),s},y.prototype.attribute=function(e){return" "+e.name+'="'+e.value+'"'},y.prototype.cdata=function(e,t){return this.space(t)+"<![CDATA["+e.text+"]]>"+this.newline},y.prototype.comment=function(e,t){return this.space(t)+"\x3c!-- "+e.text+" --\x3e"+this.newline},y.prototype.declaration=function(e,t){var n;return n=this.space(t),n+='<?xml version="'+e.version+'"',null!=e.encoding&&(n+=' encoding="'+e.encoding+'"'),null!=e.standalone&&(n+=' standalone="'+e.standalone+'"'),n+="?>",n+=this.newline},y.prototype.docType=function(o,a){var c,l,h,p,f;if(a||(a=0),p=this.space(a),p+="<!DOCTYPE "+o.root().name,o.pubID&&o.sysID?p+=' PUBLIC "'+o.pubID+'" "'+o.sysID+'"':o.sysID&&(p+=' SYSTEM "'+o.sysID+'"'),o.children.length>0){for(p+=" [",p+=this.newline,l=0,h=(f=o.children).length;l<h;l++)c=f[l],p+=function(){switch(!1){case!(c instanceof n):return this.dtdAttList(c,a+1);case!(c instanceof i):return this.dtdElement(c,a+1);case!(c instanceof r):return this.dtdEntity(c,a+1);case!(c instanceof s):return this.dtdNotation(c,a+1);case!(c instanceof e):return this.cdata(c,a+1);case!(c instanceof t):return this.comment(c,a+1);case!(c instanceof u):return this.processingInstruction(c,a+1);default:throw new Error("Unknown DTD node type: "+c.constructor.name)}}.call(this);p+="]"}return p+=">",p+=this.newline},y.prototype.element=function(n,i){var r,s,o,a,p,d,y,D,w;for(p in i||(i=0),d="",d+=(w=this.space(i))+"<"+n.name,y=n.attributes)f.call(y,p)&&(r=y[p],d+=this.attribute(r));if(0===n.children.length||n.children.every(function(e){return""===e.value}))this.allowEmpty?d+="></"+n.name+">"+this.newline:d+="/>"+this.newline;else if(this.pretty&&1===n.children.length&&null!=n.children[0].value)d+=">",d+=n.children[0].value,d+="</"+n.name+">"+this.newline;else{for(d+=">"+this.newline,o=0,a=(D=n.children).length;o<a;o++)s=D[o],d+=function(){switch(!1){case!(s instanceof e):return this.cdata(s,i+1);case!(s instanceof t):return this.comment(s,i+1);case!(s instanceof c):return this.element(s,i+1);case!(s instanceof l):return this.raw(s,i+1);case!(s instanceof h):return this.text(s,i+1);case!(s instanceof u):return this.processingInstruction(s,i+1);default:throw new Error("Unknown XML node type: "+s.constructor.name)}}.call(this);d+=w+"</"+n.name+">"+this.newline}return d},y.prototype.processingInstruction=function(e,t){var n;return n=this.space(t)+"<?"+e.target,e.value&&(n+=" "+e.value),n+="?>"+this.newline},y.prototype.raw=function(e,t){return this.space(t)+e.value+this.newline},y.prototype.text=function(e,t){return this.space(t)+e.value+this.newline},y.prototype.dtdAttList=function(e,t){var n;return n=this.space(t)+"<!ATTLIST "+e.elementName+" "+e.attributeName+" "+e.attributeType,"#DEFAULT"!==e.defaultValueType&&(n+=" "+e.defaultValueType),e.defaultValue&&(n+=' "'+e.defaultValue+'"'),n+=">"+this.newline},y.prototype.dtdElement=function(e,t){return this.space(t)+"<!ELEMENT "+e.name+" "+e.value+">"+this.newline},y.prototype.dtdEntity=function(e,t){var n;return n=this.space(t)+"<!ENTITY",e.pe&&(n+=" %"),n+=" "+e.name,e.value?n+=' "'+e.value+'"':(e.pubID&&e.sysID?n+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(n+=' SYSTEM "'+e.sysID+'"'),e.nData&&(n+=" NDATA "+e.nData)),n+=">"+this.newline},y.prototype.dtdNotation=function(e,t){var n;return n=this.space(t)+"<!NOTATION "+e.name,e.pubID&&e.sysID?n+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.pubID?n+=' PUBLIC "'+e.pubID+'"':e.sysID&&(n+=' SYSTEM "'+e.sysID+'"'),n+=">"+this.newline},y.prototype.openNode=function(e,t){var n,i,r,s;if(t||(t=0),e instanceof c){for(i in r=this.space(t)+"<"+e.name,s=e.attributes)f.call(s,i)&&(n=s[i],r+=this.attribute(n));return r+=(e.children?">":"/>")+this.newline}return r=this.space(t)+"<!DOCTYPE "+e.rootNodeName,e.pubID&&e.sysID?r+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(r+=' SYSTEM "'+e.sysID+'"'),r+=(e.children?" [":">")+this.newline},y.prototype.closeNode=function(e,t){switch(t||(t=0),!1){case!(e instanceof c):return this.space(t)+"</"+e.name+">"+this.newline;case!(e instanceof a):return this.space(t)+"]>"+this.newline}},y}()}).call(this);