const e=Editor.require("app://editor/share/adapters-build-utils"),i=Editor.require("app://editor/share/build-utils"),t="project://alipay-minigame.json",r=Editor.require("app://editor/share/3d-physics-build-utils"),n=require("path");const o={"game.js":function(e,i){let n=Editor.Profile.load(t),o=e.contents.toString(),a=`REMOTE_SERVER_ROOT = "${n.get("remoteUrl")}"`;o=o.replace(/REMOTE_SERVER_ROOT = ""/g,a);let l=i.debug?"require('cocos2d-js.js')":"require('cocos2d-js-min.js')";o=o.replace("require('cocos2d-js-path')",l);let s=i.debug?"require('adapter.js')":"require('adapter-min.js')";o=o.replace("require('adapter-js-path')",s),o=r.updateMinigameRequire(i,o),e.contents=new Buffer(o)},"game.json":function(e,r){let o=Editor.Profile.load(t),a=e.contents.toString();a=JSON.parse(a),i.combineDestJson(r,a,n.basename(e.path)),a.screenOrientation=o.get("deviceOrientation"),i.combineBuildTemplateJson(r,a,n.basename(e.path)),e.contents=new Buffer(JSON.stringify(a,null,4))}};module.exports={name:Editor.T("alipay-minigame.platform_name"),platform:"alipay",extends:"mini-game",compileFlags:function(e){return{support_jit:!1,minigame:!0}},delPattern:function(e){let i=e.dest;return[n.join(i,"**/*"),`!${n.join(i,"game.json")}`]},md5:{globalIgnore:function(){return[/.*/]}},messages:{"script-build-finished":async function(i,r){let n=null;try{(function(){if(!Editor.Profile.load(t))throw new Error("config file not found")})(),await e.buildAdapter(r,null),await e.copyRes(r,null,o),function(){let e=Editor.Profile.load(t);Editor.Metrics.trackEvent("Project","BetaPlatforms","alipay-minigame",{orientation:e.get("deviceOrientation")})}()}catch(e){n=e}i.reply(n)},"build-finished":function(e,i){let r=Editor.Profile.load(t),n={resUrl:r.get("remoteUrl"),orientation:r.get("deviceOrientation")};Editor.Ipc.sendToMain("builder:notify-build-result",i,n),e.reply()}},settings:Editor.url("packages://alipay-minigame/build-ui.js")};