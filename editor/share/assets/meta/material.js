"use strict";const s=require("./custom-asset"),t=require("fire-fs");require("fire-path");module.exports=class extends s{constructor(s){super(s),this.dataAsSubAsset=null}static version(){return"1.0.3"}static defaultType(){return"material"}import(s,t){if(this._assetdb.isSubAssetByPath(s))return this.dataAsSubAsset&&this.importJSON(s,this.dataAsSubAsset),t();super.import(s,t)}async postImport(s,e){let i,r=this._assetdb.isSubAssetByPath(s);if(r?this.dataAsSubAsset&&(i="string"==typeof this.dataAsSubAsset?JSON.parse(this.dataAsSubAsset):this.dataAsSubAsset):i=t.readJsonSync(s,"utf8"),!i)return e();if(function(s,e){if(!s._props&&!s._defines)return!1;s._techniqueData||(s._techniqueData={});let i,r,a,n=s._techniqueData,u=s._effectAsset.__uuid__,o=e._uuidToImportPathNoExt(u)+".json";try{i=t.readJsonSync(o)}catch(s){return Editor.error(s),!1}try{r=i.techniques[0].passes,a=i.shaders}catch(s){return Editor.error(s),!1}for(let t=0;t<r.length;t++){let e=r[t];if(e.properties&&s._props)for(let i in s._props)void 0!==e.properties[i]&&(n[t]||(n[t]={}),n[t].props||(n[t].props={}),n[t].props[i]=s._props[i]);if(s._defines){let i=a.find(s=>s.name===e.program);if(i.defines)for(let e in s._defines)i.defines.find(s=>s.name===e)&&(n[t]||(n[t]={}),n[t].defines||(n[t].defines={}),n[t].defines[e]=s._defines[e])}}return s._props=void 0,s._defines=void 0,!0}(i,this._assetdb))if(this.importJSON(s,i),r){let s=JSON.stringify({uuid:this.uuid,dataAsSubAsset:i});Editor.assetdb.saveMeta(this.uuid,s,s=>{s&&Editor.error(s)})}else t.writeFileSync(s,JSON.stringify(i,null,2));e()}};