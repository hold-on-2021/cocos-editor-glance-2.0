const t=require("fire-fs"),e=require("fire-path"),o=Editor.require("app://editor/share/build-platforms");module.exports={combineDestJson({dest:o},i,r){try{let s=e.join(o,r),l=t.readJsonSync(s);Object.assign(l,i),Object.assign(i,l)}catch(t){}},combineBuildTemplateJson({actualPlatform:o},i,r){try{let s=e.join(Editor.Project.path,"build-templates",o,r),l=t.readJsonSync(s);Object.assign(i,l)}catch(t){}},getAbsoluteBuildPath:t=>(e.posix.isAbsolute(t)||e.win32.isAbsolute(t)||(t=e.join(Editor.Project.path,t)),t),getOptions(t,e){t||(t=Editor.isMainProcess?Editor.Profile.load("project://builder.json"):Editor.remote.Profile.load("project://builder.json")),e||(e=Editor.isMainProcess?Editor.Profile.load("local://builder.json"):Editor.remote.Profile.load("local://builder.json"));let o=Object.assign({},t.getSelfData(),e.getSelfData());return this.updateOptions(o),o},getCommonOptions:function(t){t||(t=this.getOptions());let e=Object.assign({},t);return delete e.keystorePath,delete e.keystorePassword,delete e.keystoreAlias,delete e.keystoreAliasPassword,e},updateOptions(t){let i=t.buildPath=this.getAbsoluteBuildPath(t.buildPath),r=e.join(i,this._getOutputDir(t.actualPlatform)||t.actualPlatform);o[t.platform].useTemplate&&(r=e.join(i,"jsb-"+t.template)),t.dest=r},_getOutputDir(t){let e=("browser"===process.type?Editor.Builder:Editor.remote.Builder).simpleBuildTargets[t];return e&&e.output||null}};