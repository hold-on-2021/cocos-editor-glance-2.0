"use strict";var e=require("electron"),n=require("fire-path"),s=e.ipcRenderer,t=Editor.require("unpack://engine-dev/cocos2d/core/platform/callbacks-invoker"),c=cc.AssetLibrary;function o(e){cc.loader.release(e)}s.on("asset-db:assets-moved",function(e,n){n.forEach(function(e){c.onAssetMoved(e.uuid,e.srcPath,e.destPath)})}),s.on("asset-db:asset-changed",function(e,n){c.onAssetChanged(n.uuid)}),s.on("asset-db:assets-deleted",function(e,n){n.forEach(function(e){c.onAssetRemoved(e.uuid,e.path)})});var a=c.assetListener=new t;c.onAssetMoved=function(e,s,t){var i=n.basenameNoExt(s),r=n.basenameNoExt(t);cc.loader.refreshUrl(e,s,t),a.hasEventListener(e)&&c._queryAssetInfoInEditor(e,function(n,s,t,i){n||(o(s),cc.js.isChildClassOf(i,cc.Scene)||c.loadAsset(e,function(n,s){a.emit(e,s)}))}),"undefined"!=typeof _Scene&&c._queryAssetInfoInEditor(e,function(n,s,t,c){n||cc.js.isChildClassOf(c,cc.Prefab)&&_Scene.walk(cc.director.getScene(),!1,n=>{var s=n._prefab;if(s){if(s.asset&&s.asset._uuid===e)n.name!==i||(n.name=r);return!0}})})},c.onAssetChanged=function(e){c._queryAssetInfoInEditor(e,function(n,s,t,i){n||a.hasEventListener(e)&&(o(s),cc.js.isChildClassOf(i,cc.Scene)||c.loadAsset(e,function(n,s){a.emit(e,s)}))})},c.onAssetRemoved=function(e,n){o(n),console.log("delete cache of "+n),a.emit(e,null)};